Ãu
hD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.API\Controllers\AgrupacionController.cs
	namespace 	
Antara
 
. 
API 
. 
Controllers  
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class  
AgrupacionController %
:& '

Controller( 2
{ 
private 
readonly '
IGestionarAgrupacionService 4
_agrupacionService5 G
;G H
public  
AgrupacionController #
(# $'
IGestionarAgrupacionService$ ?
agrupacionService@ Q
)Q R
{ 	
_agrupacionService 
=  
agrupacionService! 2
;2 3
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
AgrupacionDto' 4
>4 5
>5 6!
CreateAgrupacionAsync7 L
(L M
[M N
FromBodyN V
]V W
CreateAgrupacionDtoX k
agrupacionDtol y
)y z
{ 	
try 
{ 

Agrupacion 
newAgrupacion (
=) *
new+ .
(. /
)/ 0
{   
Id!! 
=!! 
Guid!! 
.!! 
NewGuid!! %
(!!% &
)!!& '
,!!' (
Name"" 
="" 
agrupacionDto"" (
.""( )
Name"") -
,""- .
Description## 
=##  !
agrupacionDto##" /
.##/ 0
Description##0 ;
,##; <
PublicationDate$$ #
=$$$ %
DateTime$$& .
.$$. /
Parse$$/ 4
($$4 5
$str$$5 A
)$$A B
,$$B C
IsPublished%% 
=%%  !
false%%" '
,%%' (
Type&& 
=&& 
agrupacionDto&& (
.&&( )
Type&&) -
,&&- .
User_id'' 
='' 
agrupacionDto'' +
.''+ ,
User_id'', 3
}(( 
;(( 
await)) 
_agrupacionService)) (
.))( )
CreateAgrupacion))) 9
())9 :
newAgrupacion)): G
)))G H
;))H I
return** 
CreatedAtAction** &
(**& '
$str**' 6
,**6 7
new**8 ;
{**< =
id**> @
=**A B
newAgrupacion**C P
.**P Q
Id**Q S
}**T U
,**U V
newAgrupacion**W d
.**d e
AsDto**e j
(**j k
)**k l
)**l m
;**m n
}++ 
catch,, 
(,, 
	Exception,, 
err,,  
),,  !
{-- 
if.. 
(.. 
err.. 
... 
Message.. 
...  
Contains..  (
(..( )
$str..) I
)..I J
)..J K
{// 
return00 

StatusCode00 %
(00% &
$num00& )
,00) *
Json00+ /
(00/ 0
new000 3
{004 5
error006 ;
=00< =
err00> A
.00A B
Message00B I
}00J K
)00K L
)00L M
;00M N
}11 
else22 
return22 

StatusCode22 &
(22& '
$num22' *
,22* +
err22, /
.22/ 0
Message220 7
)227 8
;228 9
}33 
}44 	
[66 	
HttpGet66	 
(66 
$str66 
)66 
]66 
public77 
async77 
Task77 
<77 
ActionResult77 &
<77& '
AgrupacionDto77' 4
>774 5
>775 6
GetAgrupacionAsync777 I
(77I J
Guid77J N
id77O Q
)77Q R
{88 	
try99 
{:: 
var;; 

agrupacion;; 
=;;  
await;;! &
_agrupacionService;;' 9
.;;9 :
GetAgrupacion;;: G
(;;G H
id;;H J
);;J K
;;;K L
if<< 
(<< 

agrupacion<< 
==<< !
null<<" &
)<<& '
{== 
return>> 
NotFound>> #
(>># $
)>>$ %
;>>% &
}?? 
return@@ 

StatusCode@@ !
(@@! "
$num@@" %
,@@% &

agrupacion@@' 1
.@@1 2
AsDto@@2 7
(@@7 8
)@@8 9
)@@9 :
;@@: ;
}AA 
catchBB 
(BB 
	ExceptionBB 
errBB  
)BB  !
{CC 
returnDD 

StatusCodeDD !
(DD! "
$numDD" %
,DD% &
errDD' *
.DD* +
MessageDD+ 2
)DD2 3
;DD3 4
}EE 
}FF 	
[HH 	
HttpGetHH	 
(HH 
$strHH 
)HH  
]HH  !
publicII 
asyncII 
TaskII 
<II 
ActionResultII &
<II& '
ListII' +
<II+ ,
AgrupacionDtoII, 9
>II9 :
>II: ;
>II; <!
GetAllAgrupacionAsyncII= R
(IIR S
GuidIIS W
userIdIIX ^
)II^ _
{JJ 	
tryKK 
{LL 
varMM 
agrupacionListMM "
=MM# $
(MM% &
awaitMM& +
_agrupacionServiceMM, >
.MM> ?
GetAllAgrupacionMM? O
(MMO P
userIdMMP V
)MMV W
)MMW X
.MMX Y
SelectMMY _
(MM_ `
itemMM` d
=>MMe g
itemMMh l
.MMl m
AsDtoMMm r
(MMr s
)MMs t
)MMt u
;MMu v
returnNN 

StatusCodeNN !
(NN! "
$numNN" %
,NN% &
agrupacionListNN' 5
)NN5 6
;NN6 7
}OO 
catchPP 
(PP 
	ExceptionPP 
errPP  
)PP  !
{QQ 
returnRR 

StatusCodeRR !
(RR! "
$numRR" %
,RR% &
errRR' *
.RR* +
MessageRR+ 2
)RR2 3
;RR3 4
}SS 
}TT 	
[VV 	
HttpPutVV	 
]VV 
publicWW 
asyncWW 
TaskWW 
<WW 
ActionResultWW &
>WW& '!
UpdateAgrupacionAsyncWW( =
(WW= >
GuidWW> B
idWWC E
,WWE F
UpdateAgrupacionDtoWWG Z
agrupacionDtoWW[ h
)WWh i
{XX 	
tryYY 
{ZZ 

Agrupacion[[ 
existingAgrupacion[[ -
=[[. /
await[[0 5
_agrupacionService[[6 H
.[[H I
GetAgrupacion[[I V
([[V W
id[[W Y
)[[Y Z
;[[Z [
if\\ 
(\\ 
existingAgrupacion\\ &
==\\' )
null\\* .
)\\. /
{]] 
return^^ 
NotFound^^ #
(^^# $
)^^$ %
;^^% &
}__ 

Agrupacion`` 
updatedAgrupacion`` ,
=``- .
existingAgrupacion``/ A
with``B F
{aa 
Namebb 
=bb 
agrupacionDtobb (
.bb( )
Namebb) -
,bb- .
Descriptioncc 
=cc  !
agrupacionDtocc" /
.cc/ 0
Descriptioncc0 ;
,cc; <
IsPublisheddd 
=dd  !
agrupacionDtodd" /
.dd/ 0
IsPublisheddd0 ;
,dd; <
Typeee 
=ee 
agrupacionDtoee (
.ee( )
Typeee) -
,ee- .
}ff 
;ff 
awaitgg 
_agrupacionServicegg (
.gg( )
UpdateAgrupaciongg) 9
(gg9 :
updatedAgrupaciongg: K
)ggK L
;ggL M
returnhh 

StatusCodehh !
(hh! "
$numhh" %
)hh% &
;hh& '
}ii 
catchjj 
(jj 
	Exceptionjj 
errjj  
)jj  !
{kk 
returnll 

StatusCodell !
(ll! "
$numll" %
,ll% &
errll' *
.ll* +
Messagell+ 2
)ll2 3
;ll3 4
}mm 
}nn 	
[pp 	

HttpDeletepp	 
(pp 
$strpp 
)pp 
]pp 
publicqq 
asyncqq 
Taskqq 
<qq 
ActionResultqq &
>qq& '!
DeleteAgrupacionAsyncqq( =
(qq= >
Guidqq> B
idqqC E
)qqE F
{rr 	
tryss 
{tt 
varuu 
existingAgrupacionuu &
=uu' (
awaituu) .
_agrupacionServiceuu/ A
.uuA B
GetAgrupacionuuB O
(uuO P
iduuP R
)uuR S
;uuS T
ifvv 
(vv 
existingAgrupacionvv &
==vv' )
nullvv* .
)vv. /
{ww 
returnxx 
NotFoundxx #
(xx# $
)xx$ %
;xx% &
}yy 
awaitzz 
_agrupacionServicezz (
.zz( )
DeleteAgrupacionzz) 9
(zz9 :
idzz: <
)zz< =
;zz= >
return{{ 

StatusCode{{ !
({{! "
$num{{" %
){{% &
;{{& '
}|| 
catch}} 
(}} 
	Exception}} 
err}}  
)}}  !
{~~ 
return 

StatusCode !
(! "
$num" %
,% &
err' *
.* +
Message+ 2
)2 3
;3 4
}
ÄÄ 
}
ÅÅ 	
[
ÉÉ 	
HttpPost
ÉÉ	 
(
ÉÉ 
$str
ÉÉ 
)
ÉÉ 
]
ÉÉ 
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
ActionResult
ÑÑ &
>
ÑÑ& '"
AddAudioToAgrupacion
ÑÑ( <
(
ÑÑ< =
[
ÑÑ= >
FromBody
ÑÑ> F
]
ÑÑF G
AgrupacionAudio
ÑÑG V
agrupacion_audio
ÑÑW g
)
ÑÑg h
{
ÖÖ 	
try
ÜÜ 
{
áá 
var
ââ  
existingAgrupacion
ââ &
=
ââ' (
await
ââ) . 
_agrupacionService
ââ/ A
.
ââA B
GetAgrupacion
ââB O
(
ââO P
agrupacion_audio
ââP `
.
ââ` a
Agrupacion_id
ââa n
)
âân o
;
ââo p
if
ää 
(
ää  
existingAgrupacion
ää %
==
ää& (
null
ää) -
)
ää- .
{
ãã 
return
åå 
NotFound
åå #
(
åå# $
agrupacion_audio
åå$ 4
.
åå4 5
Agrupacion_id
åå5 B
)
ååB C
;
ååC D
}
çç 
await
éé  
_agrupacionService
éé (
.
éé( )"
AddAudioToAgrupacion
éé) =
(
éé= >
agrupacion_audio
éé> N
)
ééN O
;
ééO P
return
èè 

StatusCode
èè !
(
èè! "
$num
èè" %
)
èè% &
;
èè& '
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
err
ëë  
)
ëë  !
{
íí 
return
ìì 

StatusCode
ìì !
(
ìì! "
$num
ìì" %
,
ìì% &
err
ìì' *
.
ìì* +
Message
ìì+ 2
)
ìì2 3
;
ìì3 4
}
îî 
}
ïï 	
[
óó 	

HttpDelete
óó	 
(
óó 
$str
óó 
)
óó 
]
óó 
public
òò 
async
òò 
Task
òò 
<
òò 
ActionResult
òò &
>
òò& ''
RemoveAudioFromAgrupacion
òò( A
(
òòA B
Guid
òòB F
agrupacionId
òòG S
,
òòS T
Guid
òòU Y
audioId
òòZ a
)
òòa b
{
ôô 	
try
öö 
{
õõ 
var
úú  
existingAgrupacion
úú &
=
úú' (
await
úú) . 
_agrupacionService
úú/ A
.
úúA B
GetAgrupacion
úúB O
(
úúO P
agrupacionId
úúP \
)
úú\ ]
;
úú] ^
if
ùù 
(
ùù  
existingAgrupacion
ùù &
==
ùù' )
null
ùù* .
)
ùù. /
{
ûû 
return
üü 
NotFound
üü #
(
üü# $
agrupacionId
üü$ 0
)
üü0 1
;
üü1 2
}
†† 
await
°°  
_agrupacionService
°° (
.
°°( )'
RemoveAudioFromAgrupacion
°°) B
(
°°B C
agrupacionId
°°C O
,
°°O P
audioId
°°Q X
)
°°X Y
;
°°Y Z
return
¢¢ 

StatusCode
¢¢ !
(
¢¢! "
$num
¢¢" %
)
¢¢% &
;
¢¢& '
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
err
§§  
)
§§  !
{
•• 
return
¶¶ 

StatusCode
¶¶ !
(
¶¶! "
$num
¶¶" %
,
¶¶% &
err
¶¶' *
.
¶¶* +
Message
¶¶+ 2
)
¶¶2 3
;
¶¶3 4
}
ßß 
}
®® 	
[
™™ 	
HttpPut
™™	 
(
™™ 
$str
™™  
)
™™  !
]
™™! "
public
´´ 
async
´´ 
Task
´´ 
<
´´ 
ActionResult
´´ &
>
´´& '
ReleaseAgrupacion
´´( 9
(
´´9 :
Guid
´´: >
id
´´? A
)
´´A B
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
var
ØØ  
existingAgrupacion
ØØ &
=
ØØ' (
await
ØØ) . 
_agrupacionService
ØØ/ A
.
ØØA B
GetAgrupacion
ØØB O
(
ØØO P
id
ØØP R
)
ØØR S
;
ØØS T
if
∞∞ 
(
∞∞  
existingAgrupacion
∞∞ &
==
∞∞' )
null
∞∞* .
)
∞∞. /
{
±± 
return
≤≤ 
NotFound
≤≤ #
(
≤≤# $
id
≤≤$ &
)
≤≤& '
;
≤≤' (
}
≥≥ 
await
¥¥  
_agrupacionService
¥¥ (
.
¥¥( )
Publish
¥¥) 0
(
¥¥0 1 
existingAgrupacion
¥¥1 C
)
¥¥C D
;
¥¥D E
return
µµ 

StatusCode
µµ !
(
µµ! "
$num
µµ" %
)
µµ% &
;
µµ& '
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
err
∑∑  
)
∑∑  !
{
∏∏ 
return
ππ 

StatusCode
ππ !
(
ππ! "
$num
ππ" %
,
ππ% &
err
ππ' *
.
ππ* +
Message
ππ+ 2
)
ππ2 3
;
ππ3 4
}
∫∫ 
}
ªª 	
}
ºº 
}ΩΩ ∆j
cD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.API\Controllers\AudioController.cs
	namespace 	
Antara
 
. 
API 
. 
Controllers  
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AudioController  
:! "

Controller# -
{ 
private 
readonly "
IGestionarAudioService /"
_gestionarAudioService0 F
;F G
public 
AudioController 
( "
IGestionarAudioService 5!
gestionarAudioService6 K
)K L
{ 	"
_gestionarAudioService "
=# $!
gestionarAudioService% :
;: ;
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
AudioDto' /
>/ 0
>0 1
CreateAudioAsync2 B
(B C
[C D
FromBodyD L
]L M
CreateAudioDtoN \
audioDto] e
)e f
{ 	
try 
{ 
Audio 
newAudio 
=  
new! $
($ %
)% &
{ 
Id 
= 
Guid 
. 
NewGuid %
(% &
)& '
,' (
Name   
=   
audioDto   #
.  # $
Name  $ (
,  ( )
RegistrationDate!! $
=!!% &
DateTime!!' /
.!!/ 0
Now!!0 3
,!!3 4
CreationYear""  
=""! "
audioDto""# +
.""+ ,
CreationYear"", 8
,""8 9
Interpreter## 
=##  !
audioDto##" *
.##* +
Interpreter##+ 6
,##6 7
Writer$$ 
=$$ 
audioDto$$ %
.$$% &
Writer$$& ,
,$$, -
Producer%% 
=%% 
audioDto%% '
.%%' (
Producer%%( 0
,%%0 1
Reproductions&& !
=&&" #
$num&&$ %
,&&% &
	Genero_id'' 
='' 
audioDto''  (
.''( )
	Genero_id'') 2
,''2 3
Url(( 
=(( 
audioDto(( "
.((" #
Url((# &
,((& '
User_id)) 
=)) 
audioDto)) &
.))& '
User_id))' .
}** 
;** 
await++ "
_gestionarAudioService++ ,
.++, -
CreateAudio++- 8
(++8 9
newAudio++9 A
)++A B
;++B C
return,, 
CreatedAtAction,, &
(,,& '
$str,,' 1
,,,1 2
new,,3 6
{,,7 8
id,,9 ;
=,,< =
newAudio,,> F
.,,F G
Id,,G I
},,J K
,,,K L
newAudio,,M U
.,,U V
AsDto,,V [
(,,[ \
),,\ ]
),,] ^
;,,^ _
}-- 
catch.. 
(.. 
	Exception.. 
err..  
)..  !
{// 
if00 
(00 
err00 
.00 
Message00 
.00  
Contains00  (
(00( )
$str00) X
)00X Y
||11 
err11 
.11 
Message11 "
.11" #
Contains11# +
(11+ ,
$str11, G
)11G H
)11H I
{22 
return33 

StatusCode33 %
(33% &
$num33& )
,33) *
Json33+ /
(33/ 0
new330 3
{334 5
error336 ;
=33< =
err33> A
.33A B
Message33B I
}33J K
)33K L
)33L M
;33M N
}44 
else55 
return55 

StatusCode55 &
(55& '
$num55' *
,55* +
err55, /
)55/ 0
;550 1
}66 
}77 	
[99 	
HttpGet99	 
(99 
$str99 %
)99% &
]99& '
public:: 
async:: 
Task:: 
<:: 
ActionResult:: &
<::& '
List::' +
<::+ ,
AudioDto::, 4
>::4 5
>::5 6
>::6 7
GetAllAudioAsync::8 H
(::H I
Guid::I M
agrupacionId::N Z
)::Z [
{;; 	
try<< 
{== 
var>> 
	audioList>> 
=>> 
(>>  !
await>>! &"
_gestionarAudioService>>' =
.>>= >
GetAllAudio>>> I
(>>I J
agrupacionId>>J V
)>>V W
)>>W X
.>>X Y
Select>>Y _
(>>_ `
item>>` d
=>>>e g
item>>h l
.>>l m
AsDto>>m r
(>>r s
)>>s t
)>>t u
;>>u v
return?? 

StatusCode?? !
(??! "
$num??" %
,??% &
	audioList??' 0
)??0 1
;??1 2
}@@ 
catchAA 
(AA 
	ExceptionAA 
errAA  
)AA  !
{BB 
returnCC 

StatusCodeCC !
(CC! "
$numCC" %
,CC% &
errCC' *
)CC* +
;CC+ ,
}DD 
}EE 	
[GG 	
HttpGetGG	 
(GG 
$strGG 
)GG 
]GG 
publicHH 
asyncHH 
TaskHH 
<HH 
ActionResultHH &
<HH& '
AudioDtoHH' /
>HH/ 0
>HH0 1
GetAudioAsyncHH2 ?
(HH? @
GuidHH@ D
idHHE G
)HHG H
{II 	
tryJJ 
{KK 
varLL 
audioLL 
=LL 
awaitLL !"
_gestionarAudioServiceLL" 8
.LL8 9
GetAudioLL9 A
(LLA B
idLLB D
)LLD E
;LLE F
ifMM 
(MM 
audioMM 
==MM 
nullMM !
)MM! "
{NN 
returnOO 
NotFoundOO #
(OO# $
)OO$ %
;OO% &
}PP 
returnQQ 

StatusCodeQQ !
(QQ! "
$numQQ" %
,QQ% &
audioQQ' ,
.QQ, -
AsDtoQQ- 2
(QQ2 3
)QQ3 4
)QQ4 5
;QQ5 6
}RR 
catchSS 
(SS 
	ExceptionSS 
errSS  
)SS  !
{TT 
returnUU 

StatusCodeUU !
(UU! "
$numUU" %
,UU% &
errUU' *
)UU* +
;UU+ ,
}VV 
}WW 	
[YY 	
HttpPutYY	 
]YY 
publicZZ 
asyncZZ 
TaskZZ 
<ZZ 
ActionResultZZ &
>ZZ& '
UpdateAudioAsyncZZ( 8
(ZZ8 9
GuidZZ9 =
idZZ> @
,ZZ@ A
UpdateAudioDtoZZB P
audioDtoZZQ Y
)ZZY Z
{[[ 	
try\\ 
{]] 
var^^ 
existingAudio^^ !
=^^" #
await^^$ )"
_gestionarAudioService^^* @
.^^@ A
GetAudio^^A I
(^^I J
id^^J L
)^^L M
;^^M N
if__ 
(__ 
existingAudio__ !
==__" $
null__% )
)__) *
{`` 
returnaa 
NotFoundaa #
(aa# $
)aa$ %
;aa% &
}bb 
Audiocc 
updatedAudiocc "
=cc# $
existingAudiocc% 2
withcc3 7
{dd 
Nameee 
=ee 
audioDtoee #
.ee# $
Nameee$ (
,ee( )
CreationYearff  
=ff! "
audioDtoff# +
.ff+ ,
CreationYearff, 8
,ff8 9
Interpretergg 
=gg  !
audioDtogg" *
.gg* +
Interpretergg+ 6
,gg6 7
Writerhh 
=hh 
audioDtohh %
.hh% &
Writerhh& ,
,hh, -
Producerii 
=ii 
audioDtoii '
.ii' (
Producerii( 0
,ii0 1
	Genero_idjj 
=jj 
audioDtojj  (
.jj( )
	Genero_idjj) 2
,jj2 3
Urlkk 
=kk 
audioDtokk "
.kk" #
Urlkk# &
}ll 
;ll 
awaitmm "
_gestionarAudioServicemm ,
.mm, -
UpdateAudiomm- 8
(mm8 9
updatedAudiomm9 E
)mmE F
;mmF G
returnnn 

StatusCodenn !
(nn! "
$numnn" %
)nn% &
;nn& '
}oo 
catchpp 
(pp 
	Exceptionpp 
errpp  
)pp  !
{qq 
returnrr 

StatusCoderr !
(rr! "
$numrr" %
,rr% &
errrr' *
)rr* +
;rr+ ,
}ss 
}tt 	
[vv 	

HttpDeletevv	 
(vv 
$strvv 
)vv 
]vv 
publicww 
asyncww 
Taskww 
<ww 
ActionResultww &
>ww& '
DeleteAudioAsyncww( 8
(ww8 9
Guidww9 =
idww> @
)ww@ A
{xx 	
tryyy 
{zz 
var{{ 
existingAudio{{ !
={{" #
await{{$ )"
_gestionarAudioService{{* @
.{{@ A
GetAudio{{A I
({{I J
id{{J L
){{L M
;{{M N
if|| 
(|| 
existingAudio|| !
==||" $
null||% )
)||) *
{}} 
return~~ 
NotFound~~ #
(~~# $
)~~$ %
;~~% &
} 
await
ÄÄ $
_gestionarAudioService
ÄÄ ,
.
ÄÄ, -
DeleteAudio
ÄÄ- 8
(
ÄÄ8 9
id
ÄÄ9 ;
)
ÄÄ; <
;
ÄÄ< =
return
ÅÅ 

StatusCode
ÅÅ !
(
ÅÅ! "
$num
ÅÅ" %
)
ÅÅ% &
;
ÅÅ& '
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
err
ÉÉ  
)
ÉÉ  !
{
ÑÑ 
return
ÖÖ 

StatusCode
ÖÖ !
(
ÖÖ! "
$num
ÖÖ" %
,
ÖÖ% &
err
ÖÖ' *
)
ÖÖ* +
;
ÖÖ+ ,
}
ÜÜ 
}
áá 	
[
ââ 	
HttpGet
ââ	 
(
ââ 
$str
ââ 
)
ââ 
]
ââ 
public
ää 
async
ää 
Task
ää 
<
ää 
ActionResult
ää &
<
ää& '
List
ää' +
<
ää+ ,
AudioDto
ää, 4
>
ää4 5
>
ää5 6
>
ää6 7
SearchAudioAsync
ää8 H
(
ääH I
[
ääI J
Bind
ääJ N
(
ääN O
Prefix
ääO U
=
ääV W
$str
ääX `
)
ää` a
]
ääa b
string
ääc i
cadena
ääj p
)
ääp q
{
ãã 	
try
åå 
{
çç 
var
éé 
	audioList
éé 
=
éé 
(
éé  !
await
éé! &$
_gestionarAudioService
éé' =
.
éé= >
SearchAudios
éé> J
(
ééJ K
cadena
ééK Q
)
ééQ R
)
ééR S
.
ééS T
Select
ééT Z
(
ééZ [
item
éé[ _
=>
éé` b
item
ééc g
.
éég h
AsDto
ééh m
(
éém n
)
één o
)
ééo p
;
éép q
return
èè 

StatusCode
èè !
(
èè! "
$num
èè" %
,
èè% &
	audioList
èè' 0
)
èè0 1
;
èè1 2
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
err
ëë  
)
ëë  !
{
íí 
return
ìì 

StatusCode
ìì !
(
ìì! "
$num
ìì" %
,
ìì% &
err
ìì' *
)
ìì* +
;
ìì+ ,
}
îî 
}
ïï 	
[
ññ 	
HttpPut
ññ	 
(
ññ 
$str
ññ 
)
ññ 
]
ññ 
public
óó 
async
óó 
Task
óó 
<
óó 
ActionResult
óó &
>
óó& '
	PlayAudio
óó( 1
(
óó1 2
Guid
óó2 6
id
óó7 9
)
óó9 :
{
òò 	
try
ôô 
{
öö 
var
õõ 
existingAudio
õõ !
=
õõ" #
await
õõ$ )$
_gestionarAudioService
õõ* @
.
õõ@ A
GetAudio
õõA I
(
õõI J
id
õõJ L
)
õõL M
;
õõM N
if
úú 
(
úú 
existingAudio
úú  
==
úú! #
null
úú$ (
)
úú( )
{
ùù 
return
ûû 
NotFound
ûû #
(
ûû# $
)
ûû$ %
;
ûû% &
}
üü 
await
†† $
_gestionarAudioService
†† ,
.
††, -
ReproducirAudio
††- <
(
††< =
existingAudio
††= J
)
††J K
;
††K L
return
°° 

StatusCode
°° !
(
°°! "
$num
°°" %
)
°°% &
;
°°& '
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
err
££  
)
££  !
{
§§ 
return
•• 

StatusCode
•• !
(
••! "
$num
••" %
,
••% &
err
••' *
)
••* +
;
••+ ,
}
¶¶ 
}
ßß 	
}
®® 
}©© <
eD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.API\Controllers\UsuarioController.cs
	namespace

 	
Antara


 
.

 
API

 
.

 
Controllers

  
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
UsuarioController "
:# $

Controller% /
{ 
private 
readonly $
IRegistrarUsuarioService 1$
_registrarUsuarioService2 J
;J K
private 
readonly 
ILoginService &
_loginService' 4
;4 5
public 
UsuarioController  
(  !$
IRegistrarUsuarioService! 9#
registrarUsuarioService: Q
,Q R
ILoginServiceS `
loginServicea m
)m n
{ 	$
_registrarUsuarioService $
=% &#
registrarUsuarioService' >
;> ?
_loginService 
= 
loginService (
;( )
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
ActionResult &
<& '

UsuarioDto' 1
>1 2
>2 3
CreateUsuarioAsync4 F
(F G
[G H
FromBodyH P
]P Q
CreateUsuarioDtoR b

usuarioDtoc m
)m n
{ 	
try 
{ 
Usuario 

newUsuario "
=# $
new% (
(( )
)) *
{ 
Id   
=   
Guid   
.   
NewGuid   %
(  % &
)  & '
,  ' (
Email!! 
=!! 

usuarioDto!! &
.!!& '
Email!!' ,
,!!, -
Password"" 
="" 

usuarioDto"" )
."") *
Password""* 2
,""2 3
Name## 
=## 

usuarioDto## %
.##% &
Name##& *
,##* +
	BirthDate$$ 
=$$ 

usuarioDto$$  *
.$$* +
	BirthDate$$+ 4
,$$4 5
Gender%% 
=%% 

usuarioDto%% '
.%%' (
Gender%%( .
,%%. /
Active&& 
=&& 
true&& !
,&&! "
RegistrationDate'' $
=''% &
DateTime''' /
.''/ 0
Now''0 3
,''3 4
Country(( 
=(( 

usuarioDto(( (
.((( )
Country(() 0
})) 
;)) 
await** $
_registrarUsuarioService** .
.**. /
CreateUsuario**/ <
(**< =

newUsuario**= G
)**G H
;**H I
return++ 
CreatedAtAction++ &
(++& '
$str++' 3
,++3 4
new++5 8
{++9 :
id++; =
=++> ?

newUsuario++@ J
.++J K
Id++K M
}++N O
,++O P

newUsuario++Q [
.++[ \
AsDto++\ a
(++a b
)++b c
)++c d
;++d e
},, 
catch-- 
(-- 
	Exception-- 
err--  
)--  !
{.. 
if// 
(// 
err// 
.// 
Message// 
.//  
Contains//  (
(//( )
$str//) W
)//W X
||00 
err00 
.00 
Message00 "
.00" #
Contains00# +
(00+ ,
$str00, I
)00I J
)00J K
{11 
return22 

StatusCode22 %
(22% &
$num22& )
,22) *
Json22+ /
(22/ 0
new220 3
{224 5
error226 ;
=22< =
err22> A
.22A B
Message22B I
}22J K
)22K L
)22L M
;22M N
}33 
else44 
return44 

StatusCode44 &
(44& '
$num44' *
,44* +
err44, /
)44/ 0
;440 1
}55 
}66 	
[99 	
HttpGet99	 
(99 
$str99 
)99 
]99 
public:: 
async:: 
Task:: 
<:: 
ActionResult:: &
<::& '
Usuario::' .
>::. /
>::/ 0
GetUsuarioAsync::1 @
(::@ A
Guid::A E
id::F H
)::H I
{;; 	
try<< 
{== 
Usuario>> 
usuario>> 
=>>  !
await>>" '$
_registrarUsuarioService>>( @
.>>@ A

GetUsuario>>A K
(>>K L
id>>L N
)>>N O
;>>O P
if?? 
(?? 
usuario?? 
==?? 
null?? #
)??# $
return@@ 
NotFound@@ #
(@@# $
)@@$ %
;@@% &
returnAA 

StatusCodeAA !
(AA! "
$numAA" %
,AA% &
usuarioAA' .
)AA. /
;AA/ 0
}BB 
catchCC 
(CC 
	ExceptionCC 
errCC  
)CC  !
{DD 
returnEE 

StatusCodeEE !
(EE! "
$numEE" %
,EE% &
errEE' *
)EE* +
;EE+ ,
}FF 
}GG 	
[JJ 	
HttpPostJJ	 
]JJ 
[KK 	
RouteKK	 
(KK 
$strKK 
)KK 
]KK 
publicLL 
asyncLL 
TaskLL 
<LL 
ActionResultLL &
>LL& '

LoginAsyncLL( 2
(LL2 3
[LL3 4
FromBodyLL4 <
]LL< =
LoginUsuarioDtoLL> M
loginDtoLLN V
)LLV W
{MM 	
tryNN 
{OO 
UsuarioPP 
userPP 
=PP 
awaitPP $
_loginServicePP% 2
.PP2 3
LoginPP3 8
(PP8 9
loginDtoPP9 A
.PPA B
EmailPPB G
,PPG H
loginDtoPPI Q
.PPQ R
PasswordPPR Z
)PPZ [
;PP[ \
ifQQ 
(QQ 
userQQ 
==QQ 
nullQQ 
)QQ  
{RR 
returnSS 
NotFoundSS #
(SS# $
loginDtoSS$ ,
.SS, -
EmailSS- 2
)SS2 3
;SS3 4
}TT 
returnUU 
JsonUU 
(UU 
newUU 
{UU  !
userUU" &
.UU& '
EmailUU' ,
,UU, -
userUU. 2
.UU2 3
NameUU3 7
,UU7 8
userUU9 =
.UU= >
	BirthDateUU> G
,UUG H
userUUI M
.UUM N
GenderUUN T
,UUT U
userUUV Z
.UUZ [
RegistrationDateUU[ k
,UUk l
userUUm q
.UUq r
CountryUUr y
}UUz {
)UU{ |
;UU| }
}VV 
catchWW 
(WW 
	ExceptionWW 
errWW  
)WW  !
{XX 
ifYY 
(YY 
errYY 
.YY 
MessageYY 
.YY 
ContainsYY '
(YY' (
$strYY( <
)YY< =
)YY= >
{YY> ?
returnZZ 

StatusCodeZZ %
(ZZ% &
$numZZ& )
,ZZ) *
JsonZZ+ /
(ZZ/ 0
newZZ0 3
{ZZ4 5
errorZZ6 ;
=ZZ< =
errZZ> A
.ZZA B
MessageZZB I
}ZZJ K
)ZZK L
)ZZL M
;ZZM N
}[[ 
throw\\ 
;\\ 
}]] 
}^^ 	
}__ 
}`` ◊

OD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.API\Program.cs
	namespace

 	
Antara


 
.

 
API

 
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} Ò1
OD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.API\Startup.cs
	namespace 	
Antara
 
. 
API 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddControllers #
(# $
)$ %
;% &
services 
. 

AddOptions 
(  
)  !
;! "
services   
.   
	Configure   
<   
AppSettings   *
>  * +
(  + ,
Configuration  , 9
.  9 :

GetSection  : D
(  D E
$str  E R
)  R S
)  S T
;  T U
services!! 
.!! 
AddTransient!! !
<!!! "
IDapper!!" )
,!!) *
Antara!!+ 1
.!!1 2

Repository!!2 <
.!!< =
Dapper!!= C
.!!C D
Dapper!!D J
>!!J K
(!!K L
)!!L M
;!!M N
services"" 
."" 
AddTransient"" !
<""! "
IUsuarioRepository""" 4
,""4 5
UsuarioRepository""6 G
>""G H
(""H I
)""I J
;""J K
services## 
.## 
AddTransient## !
<##! "
IAudioRepository##" 2
,##2 3
AudioRepository##4 C
>##C D
(##D E
)##E F
;##F G
services$$ 
.$$ 
AddTransient$$ !
<$$! "!
IAgrupacionRepository$$" 7
,$$7 8 
AgrupacionRepository$$9 M
>$$M N
($$N O
)$$O P
;$$P Q
services%% 
.%% 
AddTransient%% !
<%%! "$
IRegistrarUsuarioService%%" :
,%%: ;#
RegistrarUsuarioService%%< S
>%%S T
(%%T U
)%%U V
;%%V W
services&& 
.&& 
AddTransient&& !
<&&! "
ILoginService&&" /
,&&/ 0
LoginService&&1 =
>&&= >
(&&> ?
)&&? @
;&&@ A
services'' 
.'' 
AddTransient'' !
<''! ""
IGestionarAudioService''" 8
,''8 9!
GestionarAudioService'': O
>''O P
(''P Q
)''Q R
;''R S
services(( 
.(( 
AddTransient(( !
<((! "'
IGestionarAgrupacionService((" =
,((= >&
GestionarAgrupacionService((? Y
>((Y Z
(((Z [
)(([ \
;((\ ]
services)) 
.)) 
AddTransient)) !
<))! "
IEncryptText))" .
,)). /
EncryptText))0 ;
>)); <
())< =
)))= >
;))> ?
services11 
.11 
AddSwaggerGen11 "
(11" #
c11# $
=>11% '
{22 
c33 
.33 

SwaggerDoc33 
(33 
$str33 !
,33! "
new33# &
OpenApiInfo33' 2
{333 4
Title335 :
=33; <
$str33= H
,33H I
Version33J Q
=33R S
$str33T X
}33Y Z
)33Z [
;33[ \
}44 
)44 
;44 
services55 
.55 
AddAuthentication55 &
(55& '
)55' (
.66 
	AddGoogle66 
(66 
options66 "
=>66# %
{77 !
IConfigurationSection88 )
googleAuthSection88* ;
=88< =
Configuration88> K
.88K L

GetSection88L V
(88V W
$str88W n
)88n o
;88o p
options99 
.99 
ClientId99 $
=99% &
googleAuthSection99' 8
[998 9
$str999 D
]99D E
;99E F
options:: 
.:: 
ClientSecret:: (
=::) *
googleAuthSection::+ <
[::< =
$str::= L
]::L M
;::M N
};; 
);; 
;;; 
}== 	
public?? 
void?? 
	Configure?? 
(?? 
IApplicationBuilder?? 1
app??2 5
,??5 6
IWebHostEnvironment??7 J
env??K N
)??N O
{@@ 	
ifAA 
(AA 
envAA 
.AA 
IsDevelopmentAA !
(AA! "
)AA" #
)AA# $
{BB 
appCC 
.CC %
UseDeveloperExceptionPageCC -
(CC- .
)CC. /
;CC/ 0
appDD 
.DD 

UseSwaggerDD 
(DD 
)DD  
;DD  !
appEE 
.EE 
UseSwaggerUIEE  
(EE  !
cEE! "
=>EE# %
cEE& '
.EE' (
SwaggerEndpointEE( 7
(EE7 8
$strEE8 R
,EER S
$strEET b
)EEb c
)EEc d
;EEd e
}FF 
appGG 
.GG 
UseCorsGG 
(GG 
$strGG %
)GG% &
;GG& '
appJJ 
.JJ 
UseHttpsRedirectionJJ #
(JJ# $
)JJ$ %
;JJ% &
appLL 
.LL 

UseRoutingLL 
(LL 
)LL 
;LL 
appNN 
.NN 
UseAuthorizationNN  
(NN  !
)NN! "
;NN" #
appPP 
.PP 
UseCorsPP 
(PP 
$strPP -
)PP- .
;PP. /
appRR 
.RR 
UseEndpointsRR 
(RR 
	endpointsRR &
=>RR' )
{SS 
	endpointsTT 
.TT 
MapControllersTT (
(TT( )
)TT) *
;TT* +
}UU 
)UU 
;UU 
}VV 	
}WW 
}XX 