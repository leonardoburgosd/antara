Œm
fD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Service\GestionarAgrupacionService.cs
	namespace

 	
Antara


 
.

 
Service

 
{ 
public 

class &
GestionarAgrupacionService +
:, -'
IGestionarAgrupacionService. I
{ 
private 
readonly !
IAgrupacionRepository .!
_agrupacionRepository/ D
;D E
private 
enum 
TiposAgrupaciones &
{ 	
playlist 
, 
episodio 
, 
album 
} 	
public &
GestionarAgrupacionService )
() *!
IAgrupacionRepository* ? 
agrupacionRepository@ T
)T U
{ 	!
_agrupacionRepository !
=" # 
agrupacionRepository$ 8
;8 9
} 	
public 
Task 
< 
bool 
>  
AddAudioToAgrupacion .
(. /
AgrupacionAudio/ >
agrupacion_audio? O
)O P
{ 	
try 
{ 
if 
( 
agrupacion_audio $
.$ %
Agrupacion_id% 2
==3 5
Guid6 :
.: ;
Empty; @
||A C
agrupacion_audioD T
.T U
Audio_idU ]
==^ `
Guida e
.e f
Emptyf k
)k l
{ 
throw   
new   !
ArgumentNullException   3
(  3 4
nameof  4 :
(  : ;
agrupacion_audio  ; K
)  K L
,  L M
$str  N n
)  n o
;  o p
}!! 
return"" %
AddAudioToAgrupacionInner"" 0
(""0 1
agrupacion_audio""1 A
)""A B
;""B C
}## 
catch$$ 
($$ 
	Exception$$ 
err$$  
)$$  !
{%% 
Console&& 
.&& 
Write&& 
(&& 
err&& !
)&&! "
;&&" #
throw'' 
;'' 
}(( 
})) 	
private** 
async** 
Task** 
<** 
bool** 
>**  %
AddAudioToAgrupacionInner**! :
(**: ;
AgrupacionAudio**; J
agrupacion_audio**K [
)**[ \
{++ 	
return,, 
await,, !
_agrupacionRepository,, .
.,,. / 
AddAudioToAgrupacion,,/ C
(,,C D
agrupacion_audio,,D T
),,T U
;,,U V
}-- 	
public// 
Task// 
CreateAgrupacion// $
(//$ %

Agrupacion//% /

agrupacion//0 :
)//: ;
{00 	
try11 
{22 
if33 
(33 
Enum33 
.33 
	IsDefined33 !
(33! "
typeof33" (
(33( )
TiposAgrupaciones33) :
)33: ;
,33; <

agrupacion33< F
.33F G
Type33G K
.33K L
ToLower33L S
(33S T
)33T U
)33U V
)33V W
{44 
return55 !
CreateAgrupacionInner55 0
(550 1

agrupacion551 ;
)55; <
;55< =
}66 
throw77 
new77 
ArgumentException77 +
(77+ ,
$str77, E
,77E F
nameof77G M
(77M N

agrupacion77N X
)77X Y
)77Y Z
;77Z [
}88 
catch99 
(99 
	Exception99 
err99  
)99  !
{:: 
Console;; 
.;; 
Write;; 
(;; 
err;; !
);;! "
;;;" #
throw<< 
;<< 
}== 
}>> 	
private@@ 
async@@ 
Task@@ !
CreateAgrupacionInner@@ 0
(@@0 1

Agrupacion@@1 ;

agrupacion@@< F
)@@F G
{AA 	
awaitBB !
_agrupacionRepositoryBB '
.BB' (
CreateAgrupacionBB( 8
(BB8 9

agrupacionBB9 C
)BBC D
;BBD E
}CC 	
publicEE 
TaskEE 
DeleteAgrupacionEE $
(EE$ %
GuidEE% )
idEE* ,
)EE, -
{FF 	
tryGG 
{HH 
ifII 
(II 
idII 
==II 
GuidII 
.II 
EmptyII #
)II# $
{JJ 
throwKK 
newKK !
ArgumentNullExceptionKK 3
(KK3 4
nameofKK4 :
(KK: ;
idKK; =
)KK= >
,KK> ?
$strKK@ `
)KK` a
;KKa b
}LL 
returnMM !
DeleteAgrupacionInnerMM ,
(MM, -
idMM- /
)MM/ 0
;MM0 1
}NN 
catchOO 
(OO 
	ExceptionOO 
errOO  
)OO  !
{PP 
ConsoleQQ 
.QQ 
WriteQQ 
(QQ 
errQQ !
)QQ! "
;QQ" #
throwRR 
;RR 
}SS 
}TT 	
privateVV 
asyncVV 
TaskVV !
DeleteAgrupacionInnerVV 0
(VV0 1
GuidVV1 5
idVV6 8
)VV8 9
{WW 	
awaitXX !
_agrupacionRepositoryXX '
.XX' (
DeleteAgrupacionXX( 8
(XX8 9
idXX9 ;
)XX; <
;XX< =
}YY 	
public[[ 
Task[[ 
<[[ 

Agrupacion[[ 
>[[ 
GetAgrupacion[[  -
([[- .
Guid[[. 2
id[[3 5
)[[5 6
{\\ 	
try]] 
{^^ 
if__ 
(__ 
id__ 
==__ 
Guid__ 
.__ 
Empty__ #
)__# $
{`` 
throwaa 
newaa !
ArgumentNullExceptionaa 3
(aa3 4
nameofaa4 :
(aa: ;
idaa; =
)aa= >
,aa> ?
$straa@ `
)aa` a
;aaa b
}bb 
returncc 
GetAgrupacionInnercc )
(cc) *
idcc* ,
)cc, -
;cc- .
}dd 
catchee 
(ee 
	Exceptionee 
erree  
)ee  !
{ff 
Consolegg 
.gg 
Writegg 
(gg 
errgg !
)gg! "
;gg" #
throwhh 
;hh 
}ii 
}jj 	
privatekk 
asynckk 
Taskkk 
<kk 

Agrupacionkk %
>kk% &
GetAgrupacionInnerkk' 9
(kk9 :
Guidkk: >
idkk? A
)kkA B
{ll 	
returnmm 
awaitmm !
_agrupacionRepositorymm .
.mm. /
GetAgrupacionmm/ <
(mm< =
idmm= ?
)mm? @
;mm@ A
}nn 	
publicpp 
Taskpp 
<pp 
Listpp 
<pp 

Agrupacionpp #
>pp# $
>pp$ %
GetAllAgrupacionpp& 6
(pp6 7
Guidpp7 ;
userIdpp< B
)ppB C
{qq 	
tryss 
{tt 
ifuu 
(uu 
userIduu 
==uu 
Guiduu "
.uu" #
Emptyuu# (
)uu( )
{vv 
throwww 
newww !
ArgumentNullExceptionww 3
(ww3 4
nameofww4 :
(ww: ;
userIdww; A
)wwA B
,wwB C
$strwwD d
)wwd e
;wwe f
}xx 
returnyy !
GetAllAgrupacionInneryy ,
(yy, -
userIdyy- 3
)yy3 4
;yy4 5
}zz 
catch{{ 
({{ 
	Exception{{ 
err{{  
){{  !
{|| 
Console}} 
.}} 
Write}} 
(}} 
err}} !
)}}! "
;}}" #
throw~~ 
;~~ 
} 
}
ÄÄ 	
private
ÇÇ 
async
ÇÇ 
Task
ÇÇ 
<
ÇÇ 
List
ÇÇ 
<
ÇÇ  

Agrupacion
ÇÇ  *
>
ÇÇ* +
>
ÇÇ+ ,#
GetAllAgrupacionInner
ÇÇ- B
(
ÇÇB C
Guid
ÇÇC G
userId
ÇÇH N
)
ÇÇN O
{
ÉÉ 	
return
ÑÑ 
await
ÑÑ #
_agrupacionRepository
ÑÑ .
.
ÑÑ. /
GetAllAgrupacion
ÑÑ/ ?
(
ÑÑ? @
userId
ÑÑ@ F
)
ÑÑF G
;
ÑÑG H
}
ÖÖ 	
public
áá 
Task
áá 
UpdateAgrupacion
áá $
(
áá$ %

Agrupacion
áá% /

agrupacion
áá0 :
)
áá: ;
{
àà 	
try
ââ 
{
ää 
if
ãã 
(
ãã 
Enum
ãã 
.
ãã 
	IsDefined
ãã "
(
ãã" #
typeof
ãã# )
(
ãã) *
TiposAgrupaciones
ãã* ;
)
ãã; <
,
ãã< =

agrupacion
ãã> H
.
ããH I
Type
ããI M
.
ããM N
ToLower
ããN U
(
ããU V
)
ããV W
)
ããW X
)
ããX Y
{
åå 
return
çç #
UpdateAgrupacionInner
çç 0
(
çç0 1

agrupacion
çç1 ;
)
çç; <
;
çç< =
}
éé 
throw
èè 
new
èè 
ArgumentException
èè +
(
èè+ ,
$str
èè, E
,
èèE F
nameof
èèG M
(
èèM N

agrupacion
èèN X
)
èèX Y
)
èèY Z
;
èèZ [
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
err
ëë  
)
ëë  !
{
íí 
Console
ìì 
.
ìì 
Write
ìì 
(
ìì 
err
ìì !
)
ìì! "
;
ìì" #
throw
îî 
;
îî 
}
ïï 
}
ññ 	
private
óó 
async
óó 
Task
óó #
UpdateAgrupacionInner
óó 0
(
óó0 1

Agrupacion
óó1 ;

agrupacion
óó< F
)
óóF G
{
òò 	
await
ôô #
_agrupacionRepository
ôô '
.
ôô' (
UpdateAgrupacion
ôô( 8
(
ôô8 9

agrupacion
ôô9 C
)
ôôC D
;
ôôD E
}
öö 	
public
úú 
Task
úú 
<
úú 
bool
úú 
>
úú '
RemoveAudioFromAgrupacion
úú 3
(
úú3 4
Guid
úú4 8
agrupacionId
úú9 E
,
úúE F
Guid
úúG K
audioId
úúL S
)
úúS T
{
ùù 	
try
ûû 
{
üü 
if
†† 
(
†† 
agrupacionId
††  
==
††! #
Guid
††$ (
.
††( )
Empty
††) .
)
††. /
{
°° 
throw
¢¢ 
new
¢¢ #
ArgumentNullException
¢¢ 3
(
¢¢3 4
nameof
¢¢4 :
(
¢¢: ;
agrupacionId
¢¢; G
)
¢¢G H
,
¢¢H I
$str
¢¢J j
)
¢¢j k
;
¢¢k l
}
££ 
else
§§ 
if
§§ 
(
§§ 
audioId
§§ 
==
§§  "
Guid
§§# '
.
§§' (
Empty
§§( -
)
§§- .
{
•• 
throw
¶¶ 
new
¶¶ #
ArgumentNullException
¶¶ 3
(
¶¶3 4
nameof
¶¶4 :
(
¶¶: ;
audioId
¶¶; B
)
¶¶B C
,
¶¶C D
$str
¶¶E e
)
¶¶e f
;
¶¶f g
}
ßß 
return
®® ,
RemoveAudioFromAgrupacionInner
®® 5
(
®®5 6
agrupacionId
®®6 B
,
®®B C
audioId
®®D K
)
®®K L
;
®®L M
}
©© 
catch
™™ 
(
™™ 
	Exception
™™ 
err
™™  
)
™™  !
{
´´ 
Console
¨¨ 
.
¨¨ 
Write
¨¨ 
(
¨¨ 
err
¨¨ !
)
¨¨! "
;
¨¨" #
throw
≠≠ 
;
≠≠ 
}
ÆÆ 
}
ØØ 	
private
∞∞ 
async
∞∞ 
Task
∞∞ 
<
∞∞ 
bool
∞∞ 
>
∞∞  ,
RemoveAudioFromAgrupacionInner
∞∞! ?
(
∞∞? @
Guid
∞∞@ D
agrupacionId
∞∞E Q
,
∞∞Q R
Guid
∞∞S W
audioId
∞∞X _
)
∞∞_ `
{
±± 	
return
≤≤ 
await
≤≤ #
_agrupacionRepository
≤≤ .
.
≤≤. /'
RemoveAudioFromAgrupacion
≤≤/ H
(
≤≤H I
agrupacionId
≤≤I U
,
≤≤U V
audioId
≤≤W ^
)
≤≤^ _
;
≤≤_ `
}
≥≥ 	
public
µµ 
async
µµ 
Task
µµ 
<
µµ 
bool
µµ 
>
µµ 
Publish
µµ  '
(
µµ' (

Agrupacion
µµ( 2

agrupacion
µµ3 =
)
µµ= >
{
∂∂ 	
try
∑∑ 
{
∏∏ 
if
ππ 
(
ππ 
!
ππ 

agrupacion
ππ 
.
ππ 
IsPublished
ππ *
)
ππ* +
{
∫∫ 

agrupacion
ªª 
.
ªª 
Publish
ªª &
(
ªª& '
)
ªª' (
;
ªª( )
return
ºº 
await
ºº  #
_agrupacionRepository
ºº! 6
.
ºº6 7
Publish
ºº7 >
(
ºº> ?

agrupacion
ºº? I
)
ººI J
;
ººJ K
}
ΩΩ 
throw
ææ 
new
ææ 
ArgumentException
ææ +
(
ææ+ ,
$str
ææ, U
)
ææU V
;
ææV W
}
øø 
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
err
¿¿  
)
¿¿  !
{
¡¡ 
Console
¬¬ 
.
¬¬ 
Write
¬¬ 
(
¬¬ 
err
¬¬ !
)
¬¬! "
;
¬¬" #
throw
√√ 
;
√√ 
}
ƒƒ 
}
≈≈ 	
}
∆∆ 
}«« èZ
aD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Service\GestionarAudioService.cs
	namespace

 	
Antara


 
.

 
Service

 
{ 
public 

class !
GestionarAudioService &
:' ("
IGestionarAudioService) ?
{ 
private 
readonly 
IAudioRepository )
audioRepository* 9
;9 :
public !
GestionarAudioService $
($ %
IAudioRepository% 5
audioRepository6 E
)E F
{ 	
this 
. 
audioRepository  
=! "
audioRepository# 2
;2 3
} 	
public 
async 
Task 
CreateAudio %
(% &
Audio& +
audio, 1
)1 2
{ 	
try 
{ 
if 
( 

IsUrlValid 
( 
audio #
.# $
Url$ '
)' (
.( )
Result) /
)/ 0
{ 
await 
audioRepository )
.) *
CreateAudio* 5
(5 6
audio6 ;
); <
;< =
return 
; 
} 
throw 
new 
ArgumentException +
(+ ,
$str, \
)\ ]
;] ^
} 
catch 
( 
	Exception 
err  
)  !
{   
Console!! 
.!! 
Write!! 
(!! 
err!! !
.!!! "
Message!!" )
)!!) *
;!!* +
throw"" 
;"" 
}## 
}$$ 	
public&& 
Task&& 
DeleteAudio&& 
(&&  
Guid&&  $
id&&% '
)&&' (
{'' 	
try(( 
{)) 
if** 
(** 
id** 
==** 
Guid** 
.** 
Empty** $
)**$ %
{++ 
throw,, 
new,, !
ArgumentNullException,, 3
(,,3 4
nameof,,4 :
(,,: ;
id,,; =
),,= >
,,,> ?
$str,,@ `
),,` a
;,,a b
}-- 
return.. 
DeleteAudioInner.. '
(..' (
id..( *
)..* +
;..+ ,
}// 
catch00 
(00 
	Exception00 
err00  
)00  !
{11 
Console22 
.22 
Write22 
(22 
err22 !
.22! "
Message22" )
)22) *
;22* +
throw33 
;33 
}44 
}55 	
private77 
async77 
Task77 
DeleteAudioInner77 +
(77+ ,
Guid77, 0
id771 3
)773 4
{88 	
await99 
audioRepository99 !
.99! "
DeleteAudio99" -
(99- .
id99. 0
)990 1
;991 2
}:: 	
public<< 
async<< 
Task<< 
UpdateAudio<< %
(<<% &
Audio<<& +
audio<<, 1
)<<1 2
{== 	
try>> 
{?? 
if@@ 
(@@ 

IsUrlValid@@ 
(@@ 
audio@@ $
.@@$ %
Url@@% (
)@@( )
.@@) *
Result@@* 0
)@@0 1
{AA 
awaitBB 
audioRepositoryBB )
.BB) *
UpdateAudioBB* 5
(BB5 6
audioBB6 ;
)BB; <
;BB< =
returnCC 
;CC 
}DD 
throwEE 
newEE 
ArgumentExceptionEE +
(EE+ ,
$strEE, \
)EE\ ]
;EE] ^
}FF 
catchGG 
(GG 
	ExceptionGG 
errGG  
)GG  !
{HH 
ConsoleII 
.II 
WriteII 
(II 
errII !
.II! "
MessageII" )
)II) *
;II* +
throwJJ 
;JJ 
}KK 
}LL 	
publicNN 
TaskNN 
<NN 
AudioNN 
>NN 
GetAudioNN #
(NN# $
GuidNN$ (
idNN) +
)NN+ ,
{OO 	
tryPP 
{QQ 
ifRR 
(RR 
idRR 
==RR 
GuidRR 
.RR 
EmptyRR $
)RR$ %
{SS 
throwTT 
newTT !
ArgumentNullExceptionTT 3
(TT3 4
nameofTT4 :
(TT: ;
idTT; =
)TT= >
,TT> ?
$strTT@ `
)TT` a
;TTa b
}UU 
returnVV 
GetAudioInnerVV $
(VV$ %
idVV% '
)VV' (
;VV( )
}WW 
catchXX 
(XX 
	ExceptionXX 
errXX  
)XX  !
{YY 
ConsoleZZ 
.ZZ 
WriteZZ 
(ZZ 
errZZ !
.ZZ! "
MessageZZ" )
)ZZ) *
;ZZ* +
throw[[ 
;[[ 
}\\ 
}]] 	
private__ 
async__ 
Task__ 
<__ 
Audio__  
>__  !
GetAudioInner__" /
(__/ 0
Guid__0 4
id__5 7
)__7 8
{`` 	
returnaa 
awaitaa 
audioRepositoryaa (
.aa( )
GetAudioaa) 1
(aa1 2
idaa2 4
)aa4 5
;aa5 6
}bb 	
publicdd 
Taskdd 
<dd 
Listdd 
<dd 
Audiodd 
>dd 
>dd  
GetAllAudiodd! ,
(dd, -
Guiddd- 1
agrupacionIddd2 >
)dd> ?
{ee 	
tryff 
{gg 
ifhh 
(hh 
agrupacionIdhh  
==hh! #
Guidhh$ (
.hh( )
Emptyhh) .
)hh. /
{ii 
throwjj 
newjj !
ArgumentNullExceptionjj 3
(jj3 4
nameofjj4 :
(jj: ;
agrupacionIdjj; G
)jjG H
,jjH I
$strjjJ j
)jjj k
;jjk l
}kk 
returnll 
GetAllAudioInnerll '
(ll' (
agrupacionIdll( 4
)ll4 5
;ll5 6
}mm 
catchnn 
(nn 
	Exceptionnn 
errnn  
)nn  !
{oo 
Consolepp 
.pp 
Writepp 
(pp 
errpp !
.pp! "
Messagepp" )
)pp) *
;pp* +
throwqq 
;qq 
}rr 
}ss 	
privateuu 
asyncuu 
Taskuu 
<uu 
Listuu 
<uu  
Audiouu  %
>uu% &
>uu& '
GetAllAudioInneruu( 8
(uu8 9
Guiduu9 =
agrupacionIduu> J
)uuJ K
{vv 	
returnww 
awaitww 
audioRepositoryww (
.ww( )
GetAllAudioww) 4
(ww4 5
agrupacionIdww5 A
)wwA B
;wwB C
}xx 	
publiczz 
Taskzz 
<zz 
boolzz 
>zz 

IsUrlValidzz $
(zz$ %
stringzz% +
urlzz, /
)zz/ 0
{{{ 	
try|| 
{}} 
if~~ 
(~~ 
url~~ 
==~~ 
null~~ 
)~~  
{ 
throw
ÄÄ 
new
ÄÄ #
ArgumentNullException
ÄÄ 3
(
ÄÄ3 4
nameof
ÄÄ4 :
(
ÄÄ: ;
url
ÄÄ; >
)
ÄÄ> ?
,
ÄÄ? @
$str
ÄÄA a
)
ÄÄa b
;
ÄÄb c
}
ÅÅ 
return
ÇÇ 
IsUrlValidInner
ÇÇ &
(
ÇÇ& '
url
ÇÇ' *
)
ÇÇ* +
;
ÇÇ+ ,
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
err
ÑÑ  
)
ÑÑ  !
{
ÖÖ 
Console
ÜÜ 
.
ÜÜ 
Write
ÜÜ 
(
ÜÜ 
err
ÜÜ !
.
ÜÜ! "
Message
ÜÜ" )
)
ÜÜ) *
;
ÜÜ* +
throw
áá 
;
áá 
}
àà 
}
ââ 	
private
ãã 
async
ãã 
Task
ãã 
<
ãã 
bool
ãã 
>
ãã  
IsUrlValidInner
ãã! 0
(
ãã0 1
string
ãã1 7
url
ãã8 ;
)
ãã; <
{
åå 	
return
çç 
await
çç 
audioRepository
çç (
.
çç( )
CheckUniqueUrl
çç) 7
(
çç7 8
url
çç8 ;
)
çç; <
;
çç< =
}
éé 	
public
ëë 
Task
ëë 
<
ëë 
List
ëë 
<
ëë 
Audio
ëë 
>
ëë 
>
ëë  
SearchAudios
ëë! -
(
ëë- .
string
ëë. 4
cadena
ëë5 ;
)
ëë; <
{
íí 	
try
ìì 
{
îî 
if
ïï 
(
ïï 
cadena
ïï 
==
ïï 
null
ïï "
)
ïï" #
{
ññ 
throw
óó 
new
óó #
ArgumentNullException
óó 3
(
óó3 4
nameof
óó4 :
(
óó: ;
cadena
óó; A
)
óóA B
,
óóB C
$str
óóD d
)
óód e
;
óóe f
}
òò 
return
ôô 
SearchAudiosInner
ôô (
(
ôô( )
cadena
ôô) /
)
ôô/ 0
;
ôô0 1
}
öö 
catch
õõ 
(
õõ 
	Exception
õõ 
err
õõ  
)
õõ  !
{
úú 
Console
ùù 
.
ùù 
Write
ùù 
(
ùù 
err
ùù !
.
ùù! "
Message
ùù" )
)
ùù) *
;
ùù* +
throw
ûû 
;
ûû 
}
üü 
}
†† 	
private
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
List
¢¢ 
<
¢¢  
Audio
¢¢  %
>
¢¢% &
>
¢¢& '
SearchAudiosInner
¢¢( 9
(
¢¢9 :
string
¢¢: @
cadena
¢¢A G
)
¢¢G H
{
££ 	
return
§§ 
await
§§ 
audioRepository
§§ (
.
§§( )
SearchAudios
§§) 5
(
§§5 6
cadena
§§6 <
)
§§< =
;
§§= >
}
•• 	
public
ßß 
async
ßß 
Task
ßß 
ReproducirAudio
ßß )
(
ßß) *
Audio
ßß* /
audio
ßß0 5
)
ßß5 6
{
®® 	
try
©© 
{
™™ 
audio
´´ 
.
´´ "
AumentarReproduccion
´´ *
(
´´* +
)
´´+ ,
;
´´, -
await
¨¨ 
audioRepository
¨¨ %
.
¨¨% &
ReproducirAudio
¨¨& 5
(
¨¨5 6
audio
¨¨6 ;
.
¨¨; <
Id
¨¨< >
,
¨¨> ?
audio
¨¨@ E
.
¨¨E F
Reproductions
¨¨F S
)
¨¨S T
;
¨¨T U
}
≠≠ 
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
err
ÆÆ  
)
ÆÆ  !
{
ØØ 
Console
∞∞ 
.
∞∞ 
Write
∞∞ 
(
∞∞ 
err
∞∞ !
.
∞∞! "
Message
∞∞" )
)
∞∞) *
;
∞∞* +
throw
±± 
;
±± 
}
≤≤ 
}
≥≥ 	
}
¥¥ 
}µµ ô
XD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Service\LoginService.cs
	namespace 	
Antara
 
. 
Service 
{ 
public 

class 
LoginService 
: 
ILoginService +
{ 
private 
readonly 
IUsuarioRepository +
usuarioRepo, 7
;7 8
private 
readonly 
IEncryptText %
encryptText& 1
;1 2
public 
LoginService 
( 
IUsuarioRepository .
usuarioRepo/ :
,: ;
IEncryptText< H
encryptTextI T
)T U
{ 	
this 
. 
usuarioRepo 
= 
usuarioRepo *
;* +
this 
. 
encryptText 
= 
encryptText *
;* +
} 	
public 
Task 
< 
Usuario 
> 
Login "
(" #
string# )
email* /
,/ 0
string1 7
password8 @
)@ A
{ 	
try 
{ 
if 
( 
email 
== 
null !
)! "
{ 
throw 
new !
ArgumentNullException 3
(3 4
nameof4 :
(: ;
email; @
)@ A
,A B
$strC c
)c d
;d e
} 
else 
if 
( 
password  
==! #
null$ (
)( )
{   
throw!! 
new!! !
ArgumentNullException!! 3
(!!3 4
nameof!!4 :
(!!: ;
password!!; C
)!!C D
,!!D E
$str!!F f
)!!f g
;!!g h
}"" 
return## 

LoginInner## !
(##! "
email##" '
,##' (
password##) 1
)##1 2
;##2 3
}$$ 
catch%% 
(%% 
	Exception%% 
err%%  
)%%  !
{&& 
Console'' 
.'' 
Write'' 
('' 
err'' !
)''! "
;''" #
throw(( 
;(( 
})) 
}** 	
private,, 
async,, 
Task,, 
<,, 
Usuario,, "
>,," #

LoginInner,,$ .
(,,. /
string,,/ 5
email,,6 ;
,,,; <
string,,= C
password,,D L
),,L M
{-- 	
try.. 
{// 
Usuario00 
user00 
=00 
await00 $
usuarioRepo00% 0
.000 1
Login001 6
(006 7
email007 <
)00< =
;00= >
if11 
(11 
user11 
!=11 
null11  
)11  !
{22 
bool33 
pass33 
=33 
encryptText33  +
.33+ ,
CompararHash33, 8
(338 9
password339 A
,33A B
user33C G
.33G H
Password33H P
)33P Q
;33Q R
if44 
(44 
pass44 
)44 
{55 
return66 
usuarioRepo66 *
.66* +

GetUsuario66+ 5
(665 6
user666 :
.66: ;
Id66; =
)66= >
.66> ?
Result66? E
;66E F
}77 
}88 
return99 
null99 
;99 
}:: 
catch;; 
(;; 
	Exception;; 
e;; 
);; 
{<< 
Console== 
.== 
Write== 
(== 
e== 
)==  
;==  !
throw>> 
;>> 
}?? 
}@@ 	
}AA 
}BB £(
cD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Service\RegistrarUsuarioService.cs
	namespace

 	
Antara


 
.

 
Service

 
{ 
public 

class #
RegistrarUsuarioService (
:) *$
IRegistrarUsuarioService+ C
{ 
private 
readonly 
IUsuarioRepository +
usuarioRepo, 7
;7 8
private 
readonly 
IEncryptText %
encryptText& 1
;1 2
public #
RegistrarUsuarioService &
(& '
IUsuarioRepository' 9
usuarioRepo: E
,E F
IEncryptTextG S
encryptTextT _
)_ `
{ 	
this 
. 
usuarioRepo 
= 
usuarioRepo *
;* +
this 
. 
encryptText 
= 
encryptText *
;* +
} 	
public 
async 
Task 
CreateUsuario '
(' (
Usuario( /
usuario0 7
)7 8
{ 	
try 
{ 
if 
( 
IsEmailValid 
(  
usuario  '
.' (
Email( -
)- .
.. /
Result/ 5
)5 6
{ 
usuario 
. 
Password $
=% &
encryptText' 2
.2 3 
GeneratePasswordHash3 G
(G H
usuarioH O
.O P
PasswordP X
)X Y
;Y Z
await 
usuarioRepo %
.% &
CreateUsuario& 3
(3 4
usuario4 ;
); <
;< =
return 
; 
}   
throw!! 
new!! 
ArgumentException!! +
(!!+ ,
$str!!, a
)!!a b
;!!b c
}"" 
catch## 
(## 
	Exception## 
err##  
)##  !
{$$ 
Console%% 
.%% 
Write%% 
(%% 
err%% !
)%%! "
;%%" #
throw&& 
;&& 
}'' 
}(( 	
public** 
Task** 
<** 
Usuario** 
>** 

GetUsuario** '
(**' (
Guid**( ,
id**- /
)**/ 0
{++ 	
try,, 
{-- 
if.. 
(.. 
id.. 
==.. 
Guid.. 
... 
Empty.. $
)..$ %
{// 
throw00 
new00 !
ArgumentNullException00 3
(003 4
nameof004 :
(00: ;
id00; =
)00= >
,00> ?
$str00@ `
)00` a
;00a b
}11 
return22 
GetUsuarioInner22 &
(22& '
id22' )
)22) *
;22* +
}33 
catch44 
(44 
	Exception44 
err44  
)44  !
{55 
Console66 
.66 
Write66 
(66 
err66 !
)66! "
;66" #
throw77 
;77 
}88 
}99 	
private;; 
async;; 
Task;; 
<;; 
Usuario;; "
>;;" #
GetUsuarioInner;;$ 3
(;;3 4
Guid;;4 8
id;;9 ;
);;; <
{<< 	
return== 
await== 
usuarioRepo== $
.==$ %

GetUsuario==% /
(==/ 0
id==0 2
)==2 3
;==3 4
}>> 	
public@@ 
Task@@ 
<@@ 
Boolean@@ 
>@@ 
IsEmailValid@@ )
(@@) *
string@@* 0
email@@1 6
)@@6 7
{AA 	
tryBB 
{CC 
ifDD 
(DD 
emailDD 
==DD 
nullDD !
)DD! "
{EE 
throwFF 
newFF !
ArgumentNullExceptionFF 3
(FF3 4
nameofFF4 :
(FF: ;
emailFF; @
)FF@ A
,FFA B
$strFFC c
)FFc d
;FFd e
}GG 
returnHH 
IsEmailValidInnerHH (
(HH( )
emailHH) .
)HH. /
;HH/ 0
}II 
catchJJ 
(JJ 
	ExceptionJJ 
errJJ  
)JJ  !
{KK 
ConsoleLL 
.LL 
WriteLL 
(LL 
errLL !
)LL! "
;LL" #
throwMM 
;MM 
}NN 
}OO 	
privateQQ 
asyncQQ 
TaskQQ 
<QQ 
BooleanQQ "
>QQ" #
IsEmailValidInnerQQ$ 5
(QQ5 6
stringQQ6 <
emailQQ= B
)QQB C
{RR 	
returnSS 
awaitSS 
usuarioRepoSS $
.SS$ %
CheckUniqueEmailSS% 5
(SS5 6
emailSS6 ;
)SS; <
;SS< =
}TT 	
}UU 
}VV 