Ã 
\D:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Dapper\Dapper.cs
	namespace 	
Antara
 
. 

Repository 
. 
Dapper "
{ 
public 

class 
Dapper 
: 
IDapper !
{ 
private 
IDbConnection 

connection (
;( )
private 
readonly 
AppSettings $
settings% -
;- .
public 
Dapper 
( 
IOptions 
< 
AppSettings *
>* +
options, 3
)3 4
{ 	
settings 
= 
options 
. 
Value $
;$ %
} 	
public 
async 
Task 
< 
T 
> 
QueryWithReturn ,
<, -
T- .
>. /
(/ 0
string0 6
storedProcedure7 F
,F G
dynamicH O

parametersP Z
=[ \
null] a
)a b
{ 	
try 
{ 
using 
( 

connection !
=" #
new$ '
SqlConnection( 5
(5 6
settings6 >
.> ?
ConexionString? M
)M N
)N O
{ 
var 
result 
=  
await! &

connection' 1
.1 2

QueryAsync2 <
<< =
T= >
>> ?
(? @
storedProcedure@ O
,O P
paramQ V
:V W
(X Y
objectY _
)_ `

parameters` j
,j k
commandTypel w
:w x
CommandType	y Ñ
.
Ñ Ö
StoredProcedure
Ö î
)
î ï
;
ï ñ
return 
await !
Task" &
.& '
Run' *
(* +
(+ ,
), -
=>. 0

Enumerable1 ;
.; <
FirstOrDefault< J
<J K
TK L
>L M
(M N
resultN T
)T U
)U V
;V W
} 
}   
catch!! 
(!! 
	Exception!! 
err!!  
)!!  !
{"" 
Console## 
.## 
Write## 
(## 
err## !
)##! "
;##" #
throw$$ 
;$$ 
}%% 
}&& 	
public(( 
async(( 
Task(( 
<(( 
dynamic(( !
>((! "
Consulta((# +
<((+ ,
T((, -
>((- .
(((. /
string((/ 5#
procedimientoAlmacenado((6 M
,((M N
dynamic((O V

parametros((W a
=((b c
null((d h
)((h i
where((j o
T((p q
:((r s
class((t y
{)) 	
try** 
{++ 
using,, 
(,, 

connection,, !
=,," #
new,,$ '
SqlConnection,,( 5
(,,5 6
settings,,6 >
.,,> ?
ConexionString,,? M
),,M N
),,N O
{-- 
return.. 
await..  

connection..! +
...+ ,

QueryAsync.., 6
<..6 7
T..7 8
>..8 9
(..9 :#
procedimientoAlmacenado..: Q
,..Q R
param..S X
:..X Y
(..Z [
object..[ a
)..a b

parametros..b l
,..l m
commandType..n y
:..y z
CommandType	..{ Ü
.
..Ü á
StoredProcedure
..á ñ
)
..ñ ó
;
..ó ò
}// 
}00 
catch11 
(11 
	Exception11 
err11  
)11  !
{22 
Console33 
.33 
Write33 
(33 
err33 !
)33! "
;33" #
throw44 
;44 
}55 
}66 	
}77 
}88 ù
]D:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Dapper\IDapper.cs
	namespace 	
Antara
 
. 

Repository 
. 
Dapper "
{ 
public		 

	interface		 
IDapper		 
{

 
Task 
< 
T 
> 
QueryWithReturn 
<  
T  !
>! "
(" #
string# )
storedProcedure* 9
,9 :
dynamic; B

parametersC M
=N O
nullP T
)T U
;U V
Task 
< 
dynamic 
> 
Consulta 
< 
T  
>  !
(! "
string" (#
procedimientoAlmacenado) @
,@ A
dynamicB I

parametrosJ T
=U V
nullW [
)[ \
where] b
Tc d
:e f
classg l
;l m
} 
} Ò9
kD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Repositories\AlbumRepository.cs
	namespace

 	
Antara


 
.

 

Repository

 
.

 
Repositories

 (
{ 
public 

class 
AlbumRepository  
:! "
IAlbumRepository# 3
{ 
private 
readonly 
IDapper  
_dapper! (
;( )
public 
AlbumRepository 
( 
IDapper &
dapper' -
)- .
{ 	
_dapper 
= 
dapper 
; 
} 	
public 
async 
Task 

CrearAlbum $
($ %
Album% *
album+ 0
)0 1
{ 	
try 
{ 
await 
_dapper 
. 
QueryWithReturn -
<- .
Album. 3
>3 4
(4 5
$str5 A
,A B
newC F
{ 
@Id 
= 
album 
.  
Id  "
," #
@Nombre 
= 
album #
.# $
Nombre$ *
,* +
@Descripcion  
=! "
album# (
.( )
Descripcion) 4
,4 5
@EstaPublicado "
=# $
album% *
.* +
EstaPublicado+ 8
,8 9
@FechaPublicacion %
=& '
album( -
.- .
FechaPublicacion. >
,> ?
@PortadaUrl 
=  !
album" '
.' (

PortadaUrl( 2
,2 3

@UsuarioId 
=  
album! &
.& '
	UsuarioId' 0
,0 1
@EstaActivo   
=    !
album  " '
.  ' (

EstaActivo  ( 2
}!! 
)!! 
;!! 
}"" 
catch## 
(## 
	Exception## 
err##  
)##  !
{$$ 
Console%% 
.%% 
Write%% 
(%% 
err%% !
)%%! "
;%%" #
throw&& 
;&& 
}'' 
}(( 	
public** 
async** 
Task** 
EliminarAlbum** '
(**' (
Guid**( ,
id**- /
)**/ 0
{++ 	
try,, 
{-- 
await.. 
_dapper.. 
... 
QueryWithReturn.. -
<..- .
Usuario... 5
>..5 6
(..6 7
$str..7 F
,..F G
new..H K
{// 
@Id00 
=00 
id00 
}11 
)11 
;11 
}22 
catch33 
(33 
	Exception33 
err33  
)33  !
{44 
Console55 
.55 
Write55 
(55 
err55 !
)55! "
;55" #
throw66 
;66 
}77 
}88 	
public;; 
async;; 
Task;; 
EditarAlbum;; %
(;;% &
Album;;& +
album;;, 1
);;1 2
{<< 	
try== 
{>> 
await?? 
_dapper?? 
.?? 
QueryWithReturn?? -
<??- .
Album??. 3
>??3 4
(??4 5
$str??5 B
,??B C
new??D G
{@@ 
@IdAA 
=AA 
albumAA 
.AA  
IdAA  "
,AA" #
@NombreBB 
=BB 
albumBB #
.BB# $
NombreBB$ *
,BB* +
@DescripcionCC  
=CC! "
albumCC# (
.CC( )
DescripcionCC) 4
,CC4 5
@PortadaUrlDD 
=DD  !
albumDD" '
.DD' (

PortadaUrlDD( 2
}EE 
)EE 
;EE 
}FF 
catchGG 
(GG 
	ExceptionGG 
errGG  
)GG  !
{HH 
ConsoleII 
.II 
WriteII 
(II 
errII !
)II! "
;II" #
throwJJ 
;JJ 
}KK 
}LL 	
publicNN 
asyncNN 
TaskNN 
<NN 
AlbumNN 
>NN  
ObtenerAlbumNN! -
(NN- .
GuidNN. 2
idNN3 5
)NN5 6
{OO 	
tryPP 
{QQ 
returnRR 
awaitRR 
_dapperRR $
.RR$ %
QueryWithReturnRR% 4
<RR4 5
AlbumRR5 :
>RR: ;
(RR; <
$strRR< J
,RRJ K
newRRL O
{SS 
@IdTT 
=TT 
idTT 
,TT 
}UU 
)UU 
;UU 
}VV 
catchWW 
(WW 
	ExceptionWW 
errWW  
)WW  !
{XX 
ConsoleYY 
.YY 
WriteYY 
(YY 
errYY !
)YY! "
;YY" #
throwZZ 
;ZZ 
}[[ 
}\\ 	
public^^ 
async^^ 
Task^^ 
<^^ 
List^^ 
<^^ 
Album^^ $
>^^$ %
>^^% &(
ObtenerTodosAlbumesDeUsuario^^' C
(^^C D
Guid^^D H
userId^^I O
)^^O P
{__ 	
try`` 
{aa 
returnbb 
awaitbb 
_dapperbb $
.bb$ %
Consultabb% -
<bb- .
Albumbb. 3
>bb3 4
(bb4 5
$strbb5 T
,bbT U
newbbV Y
{cc 

@UsuarioIddd 
=dd  
userIddd! '
,dd' (
}ee 
)ee 
;ee 
}ff 
catchgg 
(gg 
	Exceptiongg 
errgg  
)gg  !
{hh 
Consoleii 
.ii 
Writeii 
(ii 
errii !
)ii! "
;ii" #
throwjj 
;jj 
}kk 
}ll 	
publicnn 
asyncnn 
Tasknn 
<nn 
boolnn 
>nn 
PublicarAlbumnn  -
(nn- .
Albumnn. 3
albumnn4 9
)nn9 :
{oo 	
trypp 
{qq 
intrr 
	resultadorr 
=rr 
awaitrr  %
_dapperrr& -
.rr- .
QueryWithReturnrr. =
<rr= >
intrr> A
>rrA B
(rrB C
$strrrC R
,rrR S
newrrT W
{ss 
albumtt 
.tt 
Idtt 
,tt 
albumuu 
.uu 
FechaPublicacionuu *
}vv 
)vv 
;vv 
ifww 
(ww 
	resultadoww 
==ww  
$numww! "
)ww" #
{xx 
returnyy 
trueyy 
;yy  
}zz 
return{{ 
false{{ 
;{{ 
}|| 
catch}} 
(}} 
	Exception}} 
err}}  
)}}  !
{~~ 
Console 
. 
Write 
( 
err !
)! "
;" #
throw
ÄÄ 
;
ÄÄ 
}
ÅÅ 
}
ÇÇ 	
}
ÉÉ 
}ÑÑ ªS
kD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Repositories\PistaRepository.cs
	namespace

 	
Antara


 
.

 

Repository

 
.

 
Repositories

 (
{ 
public 

class 
PistaRepository  
:! "
IPistaRepository# 3
{ 
private 
readonly 
IDapper  
_dapper! (
;( )
public 
PistaRepository 
( 
IDapper &
dapper' -
)- .
{ 	
_dapper 
= 
dapper 
; 
} 	
public 
async 
Task 

CrearPista $
($ %
Pista% *
pista+ 0
)0 1
{ 	
try 
{ 
await 
_dapper 
. 
QueryWithReturn -
<- .
Pista. 3
>3 4
(4 5
$str5 A
,A B
newC F
{ 
@Id 
= 
pista 
.  
Id  "
," #
@Url 
= 
pista  
.  !
Url! $
,$ %
@Nombre 
= 
pista #
.# $
Nombre$ *
,* +
@FechaRegistro "
=# $
pista% *
.* +
FechaRegistro+ 8
,8 9
@AnoCreacion  
=! "
pista# (
.( )
AnoCreacion) 4
,4 5
@Interprete 
=  !
pista" '
.' (

Interprete( 2
,2 3
@Compositor   
=    !
pista  " '
.  ' (

Compositor  ( 2
,  2 3

@Productor!! 
=!!  
pista!!! &
.!!& '
	Productor!!' 0
,!!0 1
@Reproducciones"" #
=""$ %
pista""& +
.""+ ,
Reproducciones"", :
,"": ;
	@GeneroId## 
=## 
pista##  %
.##% &
GeneroId##& .
,##. /
@AlbumId$$ 
=$$ 
pista$$ $
.$$$ %
AlbumId$$% ,
,$$, -
@EstaActivo%% 
=%%  !
pista%%" '
.%%' (

EstaActivo%%( 2
}&& 
)&& 
;&& 
}'' 
catch(( 
((( 
	Exception(( 
err((  
)((  !
{)) 
Console** 
.** 
Write** 
(** 
err** !
.**! "
Message**" )
)**) *
;*** +
throw++ 
;++ 
},, 
}-- 	
public// 
async// 
Task// 
EliminarPista// '
(//' (
Guid//( ,
id//- /
)/// 0
{00 	
try11 
{22 
await33 
_dapper33 
.33 
QueryWithReturn33 -
<33- .
dynamic33. 5
>335 6
(336 7
$str337 F
,33F G
new33H K
{44 
@Id55 
=55 
id55 
}66 
)66 
;66 
}77 
catch88 
(88 
	Exception88 
err88  
)88  !
{99 
Console:: 
.:: 
Write:: 
(:: 
err:: !
.::! "
Message::" )
)::) *
;::* +
throw;; 
;;; 
}<< 
}== 	
public@@ 
async@@ 
Task@@ 
EditarPista@@ %
(@@% &
Pista@@& +
pista@@, 1
)@@1 2
{AA 	
tryBB 
{CC 
awaitDD 
_dapperDD 
.DD 
QueryWithReturnDD -
<DD- .
dynamicDD. 5
>DD5 6
(DD6 7
$strDD7 D
,DDD E
newDDF I
{EE 
@IdFF 
=FF 
pistaFF 
.FF  
IdFF  "
,FF" #
@UrlGG 
=GG 
pistaGG  
.GG  !
UrlGG! $
,GG$ %
@NombreHH 
=HH 
pistaHH #
.HH# $
NombreHH$ *
,HH* +
@AnoCreacionII  
=II! "
pistaII# (
.II( )
AnoCreacionII) 4
,II4 5
@InterpreteJJ 
=JJ  !
pistaJJ" '
.JJ' (

InterpreteJJ( 2
,JJ2 3
@CompositorKK 
=KK  !
pistaKK" '
.KK' (

CompositorKK( 2
,KK2 3

@ProductorLL 
=LL  
pistaLL! &
.LL& '
	ProductorLL' 0
,LL0 1
	@GeneroIdMM 
=MM 
pistaMM  %
.MM% &
GeneroIdMM& .
}NN 
)NN 
;NN 
}OO 
catchQQ 
(QQ 
	ExceptionQQ 
errQQ  
)QQ  !
{RR 
ConsoleSS 
.SS 
WriteSS 
(SS 
errSS !
.SS! "
MessageSS" )
)SS) *
;SS* +
throwTT 
;TT 
}UU 
}VV 	
publicXX 
asyncXX 
TaskXX 
<XX 
PistaXX 
>XX  
ObtenerPistaXX! -
(XX- .
GuidXX. 2
idXX3 5
)XX5 6
{YY 	
tryZZ 
{[[ 
return\\ 
await\\ 
_dapper\\ $
.\\$ %
QueryWithReturn\\% 4
<\\4 5
Pista\\5 :
>\\: ;
(\\; <
$str\\< J
,\\J K
new\\L O
{]] 
@Id^^ 
=^^ 
id^^ 
}__ 
)__ 
;__ 
}`` 
catchaa 
(aa 
	Exceptionaa 
erraa  
)aa  !
{bb 
Consolecc 
.cc 
Writecc 
(cc 
errcc !
.cc! "
Messagecc" )
)cc) *
;cc* +
throwdd 
;dd 
}ee 
}ff 	
publichh 
asynchh 
Taskhh 
<hh 
Listhh 
<hh 
Pistahh $
>hh$ %
>hh% &%
ObtenerTodosPistasDeAlbumhh' @
(hh@ A
GuidhhA E
albumIdhhF M
)hhM N
{ii 	
tryjj 
{kk 
varll 

pistasListll 
=ll  
awaitll! &
_dapperll' .
.ll. /
Consultall/ 7
<ll7 8
Pistall8 =
>ll= >
(ll> ?
$strll? Z
,llZ [
newll\ _
{mm 
@AlbumIdnn 
=nn 
albumIdnn &
}oo 
)oo 
;oo 
returnpp 

pistasListpp !
;pp! "
}qq 
catchrr 
(rr 
	Exceptionrr 
errrr  
)rr  !
{ss 
Consolett 
.tt 
Writett 
(tt 
errtt !
.tt! "
Messagett" )
)tt) *
;tt* +
throwuu 
;uu 
}vv 
}ww 	
publicyy 
asyncyy 
Taskyy 
<yy 
Listyy 
<yy 
Pistayy $
>yy$ %
>yy% &(
ObtenerTodosPistasDePlaylistyy' C
(yyC D
GuidyyD H

playlistIdyyI S
)yyS T
{zz 	
try{{ 
{|| 
var}} 

pistasList}} 
=}}  
await}}! &
_dapper}}' .
.}}. /
Consulta}}/ 7
<}}7 8
Pista}}8 =
>}}= >
(}}> ?
$str}}? ]
,}}] ^
new}}_ b
{~~ 
@PlaylistId 
=  !

playlistId" ,
}
ÄÄ 
)
ÄÄ 
;
ÄÄ 
return
ÅÅ 

pistasList
ÅÅ !
;
ÅÅ! "
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
err
ÉÉ  
)
ÉÉ  !
{
ÑÑ 
Console
ÖÖ 
.
ÖÖ 
Write
ÖÖ 
(
ÖÖ 
err
ÖÖ !
.
ÖÖ! "
Message
ÖÖ" )
)
ÖÖ) *
;
ÖÖ* +
throw
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 	
public
ää 
async
ää 
Task
ää 
<
ää 
List
ää 
<
ää 
Pista
ää $
>
ää$ %
>
ää% &
BuscarPistass
ää' 4
(
ää4 5
string
ää5 ;
cadena
ää< B
)
ääB C
{
ãã 	
try
åå 
{
çç 
var
éé 

pistasList
éé 
=
éé  
await
éé! &
_dapper
éé' .
.
éé. /
Consulta
éé/ 7
<
éé7 8
Pista
éé8 =
>
éé= >
(
éé> ?
$str
éé? M
,
ééM N
new
ééO R
{
èè 
@Cadena
êê 
=
êê 
cadena
êê $
}
ëë 
)
ëë 
;
ëë 
return
íí 

pistasList
íí !
;
íí! "
}
ìì 
catch
îî 
(
îî 
	Exception
îî 
err
îî  
)
îî  !
{
ïï 
Console
ññ 
.
ññ 
Write
ññ 
(
ññ 
err
ññ !
.
ññ! "
Message
ññ" )
)
ññ) *
;
ññ* +
throw
óó 
;
óó 
}
òò 
}
ôô 	
public
õõ 
async
õõ 
Task
õõ 
ReproducirPista
õõ )
(
õõ) *
Guid
õõ* .
id
õõ/ 1
,
õõ1 2
int
õõ3 6
reproducciones
õõ7 E
)
õõE F
{
úú 	
try
ùù 
{
ûû 
await
üü 
_dapper
üü 
.
üü 
QueryWithReturn
üü -
<
üü- .
Pista
üü. 3
>
üü3 4
(
üü4 5
$str
üü5 F
,
üüF G
new
üüH K
{
†† 
@Id
°° 
=
°° 
id
°° 
,
°° 
@Reproducciones
¢¢ #
=
¢¢$ %
reproducciones
¢¢& 4
}
££ 
)
££ 
;
££ 
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
err
••  
)
••  !
{
¶¶ 
Console
ßß 
.
ßß 
Write
ßß 
(
ßß 
err
ßß !
.
ßß! "
Message
ßß" )
)
ßß) *
;
ßß* +
throw
®® 
;
®® 
}
©© 
}
™™ 	
}
´´ 
}¨¨ ùD
nD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Repositories\PlaylistRepository.cs
	namespace

 	
Antara


 
.

 

Repository

 
.

 
Repositories

 (
{ 
public 

class 
PlaylistRepository #
:$ %
IPlaylistRepository& 9
{ 
private 
readonly 
IDapper  
_dapper! (
;( )
public 
PlaylistRepository !
(! "
IDapper" )
dapper* 0
)0 1
{ 	
_dapper 
= 
dapper 
; 
} 	
public 
async 
Task 
< 
bool 
> !
AgregarPistaAPlaylist  5
(5 6
PlaylistPista6 C
playlistPistaD Q
)Q R
{ 	
try 
{ 
PlaylistPista 
	respuesta '
=( )
await* /
_dapper0 7
.7 8
QueryWithReturn8 G
<G H
PlaylistPistaH U
>U V
(V W
$strW n
,n o
newp s
{ 
playlistPista !
.! "

PlaylistId" ,
,, -
playlistPista !
.! "
PistaId" )
,) *
playlistPista !
.! "
FechaRegistro" /
} 
) 
; 
if 
( 
	respuesta 
==  
null! %
)% &
{ 
return   
false    
;    !
}!! 
return"" 
true"" 
;"" 
}## 
catch$$ 
($$ 
	Exception$$ 
err$$  
)$$  !
{%% 
Console&& 
.&& 
Write&& 
(&& 
err&& !
)&&! "
;&&" #
throw'' 
;'' 
}(( 
})) 	
public++ 
async++ 
Task++ 
CrearPlaylist++ '
(++' (
Playlist++( 0
playlist++1 9
)++9 :
{,, 	
try-- 
{.. 
await// 
_dapper// 
.// 
QueryWithReturn// -
<//- .
Playlist//. 6
>//6 7
(//7 8
$str//8 G
,//G H
new//I L
{00 
@Id11 
=11 
playlist11 "
.11" #
Id11# %
,11% &
@Nombre22 
=22 
playlist22 &
.22& '
Nombre22' -
,22- .
@Descripcion33  
=33! "
playlist33# +
.33+ ,
Descripcion33, 7
,337 8
@PortadaUrl44 
=44  !
playlist44" *
.44* +

PortadaUrl44+ 5
,445 6

@UsuarioId55 
=55  
playlist55! )
.55) *
	UsuarioId55* 3
,553 4
@EstaActivo66 
=66  !
playlist66" *
.66* +

EstaActivo66+ 5
}77 
)77 
;77 
}88 
catch99 
(99 
	Exception99 
err99  
)99  !
{:: 
Console;; 
.;; 
Write;; 
(;; 
err;; !
);;! "
;;;" #
throw<< 
;<< 
}== 
}>> 	
public@@ 
async@@ 
Task@@ 
EditarPlaylist@@ (
(@@( )
Playlist@@) 1
playlist@@2 :
)@@: ;
{AA 	
tryBB 
{CC 
awaitDD 
_dapperDD 
.DD 
QueryWithReturnDD -
<DD- .
PlaylistDD. 6
>DD6 7
(DD7 8
$strDD8 H
,DDH I
newDDJ M
{EE 
playlistFF 
.FF 
IdFF 
,FF  
playlistGG 
.GG 
NombreGG #
,GG# $
playlistHH 
.HH 
DescripcionHH (
,HH( )
playlistII 
.II 

PortadaUrlII '
}JJ 
)JJ 
;JJ 
}KK 
catchLL 
(LL 
	ExceptionLL 
errLL  
)LL  !
{MM 
ConsoleNN 
.NN 
WriteNN 
(NN 
errNN !
)NN! "
;NN" #
throwOO 
;OO 
}PP 
}QQ 	
publicSS 
asyncSS 
TaskSS 
EliminarPlaylistSS *
(SS* +
GuidSS+ /
idSS0 2
)SS2 3
{TT 	
tryUU 
{VV 
awaitWW 
_dapperWW 
.WW 
QueryWithReturnWW -
<WW- .
UsuarioWW. 5
>WW5 6
(WW6 7
$strWW7 I
,WWI J
newWWK N
{XX 
@IdYY 
=YY 
idYY 
}ZZ 
)ZZ 
;ZZ 
}[[ 
catch\\ 
(\\ 
	Exception\\ 
err\\  
)\\  !
{]] 
Console^^ 
.^^ 
Write^^ 
(^^ 
err^^ !
)^^! "
;^^" #
throw__ 
;__ 
}`` 
}aa 	
publiccc 
asynccc 
Taskcc 
<cc 
Playlistcc "
>cc" #
ObtenerPlaylistcc$ 3
(cc3 4
Guidcc4 8
idcc9 ;
)cc; <
{dd 	
tryee 
{ff 
returngg 
awaitgg 
_dappergg $
.gg$ %
QueryWithReturngg% 4
<gg4 5
Playlistgg5 =
>gg= >
(gg> ?
$strgg? P
,ggP Q
newggR U
{hh 
@Idii 
=ii 
idii 
,ii 
}jj 
)jj 
;jj 
}kk 
catchll 
(ll 
	Exceptionll 
errll  
)ll  !
{mm 
Consolenn 
.nn 
Writenn 
(nn 
errnn !
)nn! "
;nn" #
throwoo 
;oo 
}pp 
}qq 	
publicss 
asyncss 
Taskss 
<ss 
Listss 
<ss 
Playlistss '
>ss' (
>ss( ))
ObtenerTodosPlaylistDeUsuarioss* G
(ssG H
GuidssH L
userIdssM S
)ssS T
{tt 	
tryuu 
{vv 
returnww 
awaitww 
_dapperww $
.ww$ %
Consultaww% -
<ww- .
Playlistww. 6
>ww6 7
(ww7 8
$strww8 Y
,wwY Z
newww[ ^
{xx 

@UsuarioIdyy 
=yy  
userIdyy! '
,yy' (
}zz 
)zz 
;zz 
}{{ 
catch|| 
(|| 
	Exception|| 
err||  
)||  !
{}} 
Console~~ 
.~~ 
Write~~ 
(~~ 
err~~ !
)~~! "
;~~" #
throw 
; 
}
ÄÄ 
}
ÅÅ 	
public
ÉÉ 
async
ÉÉ 
Task
ÉÉ 
<
ÉÉ 
bool
ÉÉ 
>
ÉÉ #
QuitarPistaDePlaylist
ÉÉ  5
(
ÉÉ5 6
PlaylistPista
ÉÉ6 C
playlistPista
ÉÉD Q
)
ÉÉQ R
{
ÑÑ 	
try
ÖÖ 
{
ÜÜ 
int
áá 
	resultado
áá 
=
áá 
await
áá  %
_dapper
áá& -
.
áá- .
QueryWithReturn
áá. =
<
áá= >
int
áá> A
>
ááA B
(
ááB C
$str
ááC Z
,
ááZ [
new
áá\ _
{
àà 
@PlaylistId
ââ 
=
ââ  !
playlistPista
ââ" /
.
ââ/ 0

PlaylistId
ââ0 :
,
ââ: ;
@PistaId
ää 
=
ää 
playlistPista
ää ,
.
ää, -
PistaId
ää- 4
}
ãã 
)
ãã 
;
ãã 
if
åå 
(
åå 
	resultado
åå 
==
åå  
$num
åå! "
)
åå" #
{
çç 
return
éé 
true
éé 
;
éé  
}
èè 
return
êê 
false
êê 
;
êê 
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
err
íí  
)
íí  !
{
ìì 
Console
îî 
.
îî 
Write
îî 
(
îî 
err
îî !
)
îî! "
;
îî" #
throw
ïï 
;
ïï 
}
ññ 
}
óó 	
}
òò 
}ôô ì4
mD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Repositories\UsuarioRepository.cs
	namespace 	
Antara
 
. 

Repository 
. 
Repositories (
{ 
public		 

class		 
UsuarioRepository		 "
:		# $
IUsuarioRepository		% 7
{

 
private 
readonly 
IDapper  
_dapper! (
;( )
public 
UsuarioRepository  
(  !
IDapper! (
dapper) /
)/ 0
{ 	
_dapper 
= 
dapper 
; 
} 	
public 
async 
Task 
< 
Boolean !
>! "
VerificarEmailUnico# 6
(6 7
string7 =
email> C
)C D
{ 	
try 
{ 
Usuario 
	respuesta !
=" #
await$ )
_dapper* 1
.1 2
QueryWithReturn2 A
<A B
UsuarioB I
>I J
(J K
$strK `
,` a
newb e
{ 
@Email 
= 
email "
} 
) 
; 
if 
( 
	respuesta 
==  
null! %
)% &
{ 
return 
true 
;  
} 
return 
false 
; 
} 
catch 
( 
	Exception 
err  
)  !
{   
Console!! 
.!! 
Write!! 
(!! 
err!! !
)!!! "
;!!" #
throw"" 
;"" 
}## 
}$$ 	
public&& 
async&& 
Task&& 
CrearUsuario&& &
(&&& '
Usuario&&' .
usuario&&/ 6
)&&6 7
{'' 	
try(( 
{)) 
await** 
_dapper** 
.** 
QueryWithReturn** -
<**- .
Usuario**. 5
>**5 6
(**6 7
$str**7 E
,**E F
new**G J
{++ 
usuario,, 
.,, 
Id,, 
,,, 
usuario-- 
.-- 
Email-- !
,--! "
usuario.. 
... 
Password.. $
,..$ %
usuario// 
.// 
Nombre// "
,//" #
usuario00 
.00 
FechaNacimiento00 +
,00+ ,
usuario11 
.11 
Genero11 "
,11" #
usuario22 
.22 

EstaActivo22 &
,22& '
usuario33 
.33 
FechaRegistro33 )
,33) *
usuario44 
.44 
Pais44  
,44  !
usuario55 
.55 

FotoPerfil55 &
,55& '
usuario66 
.66 
Tipo66  
}77 
)77 
;77 
}88 
catch99 
(99 
	Exception99 
err99  
)99  !
{:: 
Console;; 
.;; 
Write;; 
(;; 
err;; !
);;! "
;;;" #
throw<< 
;<< 
}== 
}>> 	
public@@ 
Task@@ !
EliminarFisicoUsuario@@ )
(@@) *
Guid@@* .
id@@/ 1
)@@1 2
{AA 	
tryBB 
{CC 
ifDD 
(DD 
idDD 
==DD 
GuidDD 
.DD 
EmptyDD $
)DD$ %
{EE 
throwFF 
newFF !
ArgumentNullExceptionFF 3
(FF3 4
nameofFF4 :
(FF: ;
idFF; =
)FF= >
,FF> ?
$strFF@ `
)FF` a
;FFa b
}GG 
returnHH &
EliminarFisicoUsuarioInnerHH 1
(HH1 2
idHH2 4
)HH4 5
;HH5 6
}II 
catchJJ 
(JJ 
	ExceptionJJ 
errJJ  
)JJ  !
{KK 
ConsoleLL 
.LL 
WriteLL 
(LL 
errLL !
)LL! "
;LL" #
throwMM 
;MM 
}NN 
}OO 	
privateQQ 
asyncQQ 
TaskQQ &
EliminarFisicoUsuarioInnerQQ 5
(QQ5 6
GuidQQ6 :
idQQ; =
)QQ= >
{RR 	
awaitSS 
_dapperSS 
.SS 
QueryWithReturnSS )
<SS) *
UsuarioSS* 1
>SS1 2
(SS2 3
$strSS3 J
,SSJ K
newSSL O
{TT 
@IdUU 
=UU 
idUU 
}VV 
)VV 
;VV 
}WW 	
publicYY 
asyncYY 
TaskYY 
<YY 
UsuarioYY !
>YY! "
ObtenerUsuarioYY# 1
(YY1 2
GuidYY2 6
idYY7 9
)YY9 :
{ZZ 	
try[[ 
{\\ 
return]] 
await]] 
_dapper]] $
.]]$ %
QueryWithReturn]]% 4
<]]4 5
Usuario]]5 <
>]]< =
(]]= >
$str]]> N
,]]N O
new]]P S
{^^ 
@Id__ 
=__ 
id__ 
}`` 
)`` 
;`` 
}aa 
catchbb 
(bb 
	Exceptionbb 
errbb  
)bb  !
{cc 
Consoledd 
.dd 
Writedd 
(dd 
errdd !
)dd! "
;dd" #
throwee 
;ee 
}ff 
}gg 	
publicii 
asyncii 
Taskii 
<ii 
Usuarioii !
>ii! "
Loginii# (
(ii( )
stringii) /
emailii0 5
)ii5 6
{jj 	
trykk 
{ll 
returnmm 
awaitmm 
_dappermm $
.mm$ %
QueryWithReturnmm% 4
<mm4 5
Usuariomm5 <
>mm< =
(mm= >
$strmm> E
,mmE F
newmmG J
{nn 
@Emailoo 
=oo 
emailoo "
}pp 
)pp 
;pp 
}qq 
catchrr 
(rr 
	Exceptionrr 
errrr  
)rr  !
{ss 
Consolett 
.tt 
Writett 
(tt 
errtt !
)tt! "
;tt" #
throwuu 
;uu 
}vv 
}ww 	
}xx 
}yy 