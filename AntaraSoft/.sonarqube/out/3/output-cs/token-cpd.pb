®
\D:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Dapper\Dapper.cs
	namespace 	
Antara
 
. 

Repository 
. 
Dapper "
{ 
public 

class 
Dapper 
: 
IDapper !
{ 
private 
IDbConnection 

connection (
;( )
private 
readonly 
AppSettings $
settings% -
;- .
public 
Dapper 
( 
IOptions 
< 
AppSettings *
>* +
options, 3
)3 4
{ 	
settings 
= 
options 
. 
Value $
;$ %
} 	
public 
async 
Task 
< 
T 
> 
QueryWithReturn ,
<, -
T- .
>. /
(/ 0
string0 6
storedProcedure7 F
,F G
dynamicH O

parametersP Z
=[ \
null] a
)a b
wherec h
Ti j
:k l
classm r
{ 	
try 
{ 
using 
( 

connection !
=" #
new$ '
SqlConnection( 5
(5 6
settings6 >
.> ?
ConexionString? M
)M N
)N O
{ 
var 
result 
=  
await! &

connection' 1
.1 2

QueryAsync2 <
<< =
T= >
>> ?
(? @
storedProcedure@ O
,O P
paramQ V
:V W
(X Y
objectY _
)_ `

parameters` j
,j k
commandTypel w
:w x
CommandType	y Ñ
.
Ñ Ö
StoredProcedure
Ö î
)
î ï
;
ï ñ
return 
await !
Task" &
.& '
Run' *
(* +
(+ ,
), -
=>. 0

Enumerable1 ;
.; <
FirstOrDefault< J
<J K
TK L
>L M
(M N
resultN T
)T U
)U V
;V W
} 
}   
catch!! 
(!! 
	Exception!! 
err!!  
)!!  !
{"" 
Console## 
.## 
Write## 
(## 
err## !
)##! "
;##" #
throw$$ 
;$$ 
}%% 
}&& 	
}'' 
}(( “
]D:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Dapper\IDapper.cs
	namespace 	
Antara
 
. 

Repository 
. 
Dapper "
{ 
public		 

	interface		 
IDapper		 
{

 
Task 
< 
T 
> 
QueryWithReturn 
<  
T  !
>! "
(" #
string# )
storedProcedure* 9
,9 :
dynamic; B

parametersC M
=N O
nullP T
)T U
whereV [
T\ ]
:^ _
class` e
;e f
} 
} ÔC
mD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Repositories\UsuarioRepository.cs
	namespace 	
Antara
 
. 

Repository 
. 
Repositories (
{ 
public 

class 
UsuarioRepository "
:# $
IUsuarioRepository% 7
{ 
private 
readonly 
IDapper  
dapper! '
;' (
public 
UsuarioRepository  
(  !
IDapper! (
dapper) /
)/ 0
{ 	
this 
. 
dapper 
= 
dapper  
;  !
} 	
public 
Task 
< 
Boolean 
> 
CheckUniqueEmail -
(- .
string. 4
email5 :
): ;
{ 	
try 
{ 
if 
( 
email 
== 
null  
)  !
{ 
throw 
new !
ArgumentNullException 3
(3 4
nameof4 :
(: ;
email; @
)@ A
,A B
$strC c
)c d
;d e
} 
return !
CheckUniqueEmailInner ,
(, -
email- 2
)2 3
;3 4
} 
catch   
(   
	Exception   
err    
)    !
{!! 
Console"" 
."" 
Write"" 
("" 
err"" !
)""! "
;""" #
throw## 
;## 
}$$ 
}%% 	
public'' 
async'' 
Task'' 
<'' 
Boolean'' !
>''! "!
CheckUniqueEmailInner''# 8
(''8 9
string''9 ?
email''@ E
)''E F
{(( 	
Usuario)) 
response)) 
=)) 
await)) $
dapper))% +
.))+ ,
QueryWithReturn)), ;
<)); <
Usuario))< C
>))C D
())D E
$str))E W
,))W X
new))Y \
{** 
@Email++ 
=++ 
email++ 
},, 
),, 
;,, 
if-- 
(-- 
response-- 
==-- 
null--  
)--  !
{.. 
return// 
true// 
;// 
}00 
return11 
false11 
;11 
}22 	
public44 
async44 
Task44 
<44 
Usuario44 !
>44! "
CreateUsuario44# 0
(440 1
Usuario441 8
usuario449 @
)44@ A
{55 	
try66 
{77 
Usuario88 
nuevoUsuario88 $
=88% &
await88' ,
dapper88- 3
.883 4
QueryWithReturn884 C
<88C D
Usuario88D K
>88K L
(88L M
$str88M \
,88\ ]
new88^ a
{99 
@Email:: 
=:: 
usuario:: $
.::$ %
Email::% *
,::* +
	@Password;; 
=;; 
usuario;;  '
.;;' (
Password;;( 0
,;;0 1
@Name<< 
=<< 
usuario<< #
.<<# $
Name<<$ (
,<<( )

@BirthDate== 
===  
usuario==! (
.==( )
	BirthDate==) 2
,==2 3
@Gender>> 
=>> 
usuario>> %
.>>% &
Gender>>& ,
,>>, -
@Active?? 
=?? 
true?? "
,??" #
@RegistrationDate@@ %
=@@& '
DateTime@@( 0
.@@0 1
Now@@1 4
,@@4 5
@CountryAA 
=AA 
usuarioAA &
.AA& '
CountryAA' .
}BB 
)BB 
;BB 
returnCC 
nuevoUsuarioCC #
;CC# $
}DD 
catchEE 
(EE 
	ExceptionEE 
errEE  
)EE  !
{FF 
ConsoleGG 
.GG 
WriteGG 
(GG 
errGG !
)GG! "
;GG" #
throwHH 
;HH 
}II 
}JJ 	
publicLL 
TaskLL !
PhysicalDeleteUsuarioLL )
(LL) *
longLL* .
idLL/ 1
)LL1 2
{MM 	
tryNN 
{OO 
ifPP 
(PP 
idPP 
==PP 
$numPP 
)PP 
{QQ 
throwRR 
newRR !
ArgumentNullExceptionRR 3
(RR3 4
nameofRR4 :
(RR: ;
idRR; =
)RR= >
,RR> ?
$strRR@ `
)RR` a
;RRa b
}SS 
returnTT &
PhysicalDeleteUsuarioInnerTT 1
(TT1 2
idTT2 4
)TT4 5
;TT5 6
}UU 
catchVV 
(VV 
	ExceptionVV 
errVV  
)VV  !
{WW 
ConsoleXX 
.XX 
WriteXX 
(XX 
errXX !
)XX! "
;XX" #
throwYY 
;YY 
}ZZ 
}[[ 	
public]] 
async]] 
Task]] &
PhysicalDeleteUsuarioInner]] 4
(]]4 5
long]]5 9
id]]: <
)]]< =
{^^ 	
await__ 
dapper__ 
.__ 
QueryWithReturn__ (
<__( )
Usuario__) 0
>__0 1
(__1 2
$str__2 I
,__I J
new__K N
{`` 
@Idaa 
=aa 
idaa 
}bb 
)bb 
;bb 
}cc 	
publicee 
Taskee 
<ee 
Usuarioee 
>ee 

GetUsuarioee '
(ee' (
longee( ,
idee- /
)ee/ 0
{ff 	
trygg 
{hh 
ifii 
(ii 
idii 
==ii 
$numii 
)ii 
{jj 
throwkk 
newkk !
ArgumentNullExceptionkk 3
(kk3 4
nameofkk4 :
(kk: ;
idkk; =
)kk= >
,kk> ?
$strkk@ `
)kk` a
;kka b
}ll 
returnmm 
GetUsuarioInnermm &
(mm& '
idmm' )
)mm) *
;mm* +
}nn 
catchoo 
(oo 
	Exceptionoo 
erroo  
)oo  !
{pp 
Consoleqq 
.qq 
Writeqq 
(qq 
errqq !
)qq! "
;qq" #
throwrr 
;rr 
}ss 
}tt 	
publicvv 
asyncvv 
Taskvv 
<vv 
Usuariovv !
>vv! "
GetUsuarioInnervv# 2
(vv2 3
longvv3 7
idvv8 :
)vv: ;
{ww 	
returnxx 
awaitxx 
dapperxx 
.xx  
QueryWithReturnxx  /
<xx/ 0
Usuarioxx0 7
>xx7 8
(xx8 9
$strxx9 E
,xxE F
newxxG J
{yy 
@Idzz 
=zz 
idzz 
}{{ 
){{ 
;{{ 
}|| 	
public~~ 
async~~ 
Task~~ 
<~~ 
Usuario~~ !
>~~! "
Login~~# (
(~~( )
string~~) /
email~~0 5
)~~5 6
{ 	
try
ÄÄ 
{
ÅÅ 
if
ÇÇ 
(
ÇÇ 
email
ÇÇ 
==
ÇÇ 
null
ÇÇ !
)
ÇÇ! "
{
ÉÉ 
throw
ÑÑ 
new
ÑÑ #
ArgumentNullException
ÑÑ 3
(
ÑÑ3 4
nameof
ÑÑ4 :
(
ÑÑ: ;
email
ÑÑ; @
)
ÑÑ@ A
,
ÑÑA B
$str
ÑÑC c
)
ÑÑc d
;
ÑÑd e
}
ÖÖ 
return
ÜÜ 
await
ÜÜ 
dapper
ÜÜ #
.
ÜÜ# $
QueryWithReturn
ÜÜ$ 3
<
ÜÜ3 4
Usuario
ÜÜ4 ;
>
ÜÜ; <
(
ÜÜ< =
$str
ÜÜ= S
,
ÜÜS T
new
ÜÜU X
{
áá 
@Email
àà 
=
àà 
email
àà "
}
ââ 
)
ââ 
;
ââ 
}
ää 
catch
ãã 
(
ãã 
	Exception
ãã 
err
ãã  
)
ãã  !
{
åå 
Console
çç 
.
çç 
Write
çç 
(
çç 
err
çç !
)
çç! "
;
çç" #
throw
éé 
;
éé 
}
èè 
}
êê 	
}
ëë 
}íí 