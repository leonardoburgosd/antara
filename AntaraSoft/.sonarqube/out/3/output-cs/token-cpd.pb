é/
\D:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Dapper\Dapper.cs
	namespace 	
Antara
 
. 

Repository 
. 
Dapper "
{ 
public 

class 
Dapper 
: 
IDapper !
{ 
private 
IDbConnection 

connection (
;( )
private 
readonly 
AppSettings $
settings% -
;- .
public 
Dapper 
( 
IOptions 
< 
AppSettings *
>* +
options, 3
)3 4
{ 	
settings 
= 
options 
. 
Value $
;$ %
} 	
public 
async 
Task 
< 
dynamic !
>! "
	Consultas# ,
<, -
T- .
>. /
(/ 0
string0 6#
procedimientoAlmacenado7 N
,N O
dynamicP W

parametrosX b
=c d
nulle i
)i j
wherek p
Tq r
:s t
classu z
{ 	
try 
{ 
using 
( 

connection !
=" #
new$ '
SqlConnection( 5
(5 6
settings6 >
.> ?
ConexionString? M
)M N
)N O
{ 
return 
await  

connection! +
.+ ,

QueryAsync, 6
<6 7
T7 8
>8 9
(9 :#
procedimientoAlmacenado: Q
,Q R
paramS X
:X Y
(Z [
object[ a
)a b

parametrosb l
,l m
commandTypen y
:y z
CommandType	{ †
.
† ‡
StoredProcedure
‡ –
)
– —
;
— ˜
} 
} 
catch 
( 
	Exception 
err  
)  !
{   
Console!! 
.!! 
Write!! 
(!! 
err!! !
)!!! "
;!!" #
throw"" 
;"" 
}## 
}$$ 	
public&& 
async&& 
Task&& 
<&& 
T&& 
>&& 
Insert&& #
<&&# $
T&&$ %
>&&% &
(&&& '
string&&' -#
procedimientoAlmacenado&&. E
,&&E F
dynamic&&G N

parametros&&O Y
=&&Z [
null&&\ `
)&&` a
where&&b g
T&&h i
:&&j k
class&&l q
{'' 	
try(( 
{)) 
using** 
(** 

connection** !
=**" #
new**$ '
SqlConnection**( 5
(**5 6
settings**6 >
.**> ?
ConexionString**? M
)**M N
)**N O
{++ 
var,, 
result,, 
=,,  
await,,! &

connection,,' 1
.,,1 2

QueryAsync,,2 <
<,,< =
T,,= >
>,,> ?
(,,? @#
procedimientoAlmacenado,,@ W
,,,W X
param,,Y ^
:,,^ _
(,,` a
object,,a g
),,g h

parametros,,h r
,,,r s
commandType,,t 
:	,, €
CommandType
,, Œ
.
,,Œ 
StoredProcedure
,, œ
)
,,œ 
;
,, ž
return-- 
await--  
Task--! %
.--% &
Run--& )
(--) *
(--* +
)--+ ,
=>--- /

Enumerable--0 :
.--: ;
FirstOrDefault--; I
<--I J
T--J K
>--K L
(--L M
result--M S
)--S T
)--T U
;--U V
}.. 
}// 
catch00 
(00 
	Exception00 
err00  
)00  !
{11 
Console22 
.22 
Write22 
(22 
err22 !
)22! "
;22" #
throw33 
;33 
}44 
}55 	
public77 
async77 
Task77 
<77 
T77 
>77 
QueryWithReturn77 ,
<77, -
T77- .
>77. /
(77/ 0
string770 6
storedProcedure777 F
,77F G
dynamic77H O

parameters77P Z
=77[ \
null77] a
)77a b
where77c h
T77i j
:77k l
class77m r
{88 	
try99 
{:: 
using;; 
(;; 

connection;; !
=;;" #
new;;$ '
SqlConnection;;( 5
(;;5 6
settings;;6 >
.;;> ?
ConexionString;;? M
);;M N
);;N O
{<< 
var== 
result== 
===  
await==! &

connection==' 1
.==1 2

QueryAsync==2 <
<==< =
T=== >
>==> ?
(==? @
storedProcedure==@ O
,==O P
param==Q V
:==V W
(==X Y
object==Y _
)==_ `

parameters==` j
,==j k
commandType==l w
:==w x
CommandType	==y „
.
==„ …
StoredProcedure
==… ”
)
==” •
;
==• –
return>> 
await>> !
Task>>" &
.>>& '
Run>>' *
(>>* +
(>>+ ,
)>>, -
=>>>. 0

Enumerable>>1 ;
.>>; <
FirstOrDefault>>< J
<>>J K
T>>K L
>>>L M
(>>M N
result>>N T
)>>T U
)>>U V
;>>V W
}?? 
}@@ 
catchAA 
(AA 
	ExceptionAA 
errAA  
)AA  !
{BB 
ConsoleCC 
.CC 
WriteCC 
(CC 
errCC !
)CC! "
;CC" #
throwDD 
;DD 
}EE 
}FF 	
}GG 
}HH é
]D:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Dapper\IDapper.cs
	namespace 	
Antara
 
. 

Repository 
. 
Dapper "
{ 
public		 

	interface		 
IDapper		 
{

 
Task 
< 
dynamic 
> 
	Consultas 
<  
T  !
>! "
(" #
string# )#
procedimientoAlmacenado* A
,A B
dynamicC J

parametrosK U
=V W
nullX \
)\ ]
where^ c
Td e
:f g
classh m
;m n
Task 
< 
T 
> 
Insert 
< 
T 
> 
( 
string  #
procedimientoAlmacenado! 8
,8 9
dynamic: A

parametrosB L
=M N
nullO S
)S T
whereU Z
T[ \
:] ^
class_ d
;d e
Task 
< 
T 
> 
QueryWithReturn 
<  
T  !
>! "
(" #
string# )
storedProcedure* 9
,9 :
dynamic; B

parametersC M
=N O
nullP T
)T U
whereV [
T\ ]
:^ _
class` e
;e f
} 
} Â,
mD:\UPN\9no\CAPSTONE\Proyecto\AntaraSoft\antara\AntaraSoft\Antara.Repository\Repositories\UsuarioRepository.cs
	namespace 	
Antara
 
. 

Repository 
. 
Repositories (
{ 
public 

class 
UsuarioRepository "
:# $
IUsuarioRepository% 7
{ 
private 
readonly 
IDapper  
dapper! '
;' (
public 
UsuarioRepository  
(  !
IDapper! (
dapper) /
)/ 0
{ 	
this 
. 
dapper 
= 
dapper  
;  !
} 	
public 
async 
Task 
< 
Boolean !
>! "
CheckUniqueEmail# 3
(3 4
string4 :
email; @
)@ A
{ 	
try 
{ 
Usuario 
response  
=! "
await# (
dapper) /
./ 0
QueryWithReturn0 ?
<? @
Usuario@ G
>G H
(H I
$strI [
,[ \
new] `
{ 
@Email 
= 
email "
} 
) 
; 
if 
( 
response 
== 
null  $
)$ %
{ 
return   
true   
;    
}!! 
return"" 
false"" 
;"" 
}## 
catch$$ 
($$ 
	Exception$$ 
err$$  
)$$  !
{%% 
Console&& 
.&& 
Write&& 
(&& 
err&& !
)&&! "
;&&" #
throw'' 
;'' 
}(( 
})) 	
public++ 
async++ 
Task++ 
<++ 
Usuario++ !
>++! "
CreateUsuario++# 0
(++0 1
Usuario++1 8
usuario++9 @
)++@ A
{,, 	
try-- 
{.. 
Usuario// 
nuevoUsuario// $
=//% &
await//' ,
dapper//- 3
.//3 4
QueryWithReturn//4 C
<//C D
Usuario//D K
>//K L
(//L M
$str//M \
,//\ ]
new//^ a
{00 
@Email11 
=11 
usuario11 $
.11$ %
Email11% *
,11* +
	@Password22 
=22 
usuario22  '
.22' (
Password22( 0
,220 1
@Name33 
=33 
usuario33 #
.33# $
Name33$ (
,33( )

@BirthDate44 
=44  
usuario44! (
.44( )
	BirthDate44) 2
,442 3
@Gender55 
=55 
usuario55 %
.55% &
Gender55& ,
,55, -
@Active66 
=66 
true66 "
,66" #
@RegistrationDate77 %
=77& '
DateTime77( 0
.770 1
Now771 4
,774 5
@Country88 
=88 
usuario88 &
.88& '
Country88' .
}99 
)99 
;99 
return:: 
nuevoUsuario:: #
;::# $
};; 
catch<< 
(<< 
	Exception<< 
err<<  
)<<  !
{== 
Console>> 
.>> 
Write>> 
(>> 
err>> !
)>>! "
;>>" #
throw?? 
;?? 
}@@ 
}AA 	
publicCC 
asyncCC 
TaskCC 
<CC 
UsuarioCC !
>CC! "

GetUsuarioCC# -
(CC- .
longCC. 2
idCC3 5
)CC5 6
{DD 	
tryEE 
{FF 
varGG 
responseGG 
=GG 
awaitGG $
dapperGG% +
.GG+ ,
QueryWithReturnGG, ;
<GG; <
UsuarioGG< C
>GGC D
(GGD E
$strGGE Q
,GGQ R
newGGS V
{HH 
@IdII 
=II 
idII 
}JJ 
)JJ 
;JJ 
ifKK 
(KK 
responseKK 
==KK 
nullKK  $
)KK$ %
{LL 
returnMM 
nullMM 
;MM  
}NN 
returnOO 
responseOO 
;OO  
}PP 
catchQQ 
(QQ 
	ExceptionQQ 
errQQ  
)QQ  !
{RR 
ConsoleSS 
.SS 
WriteSS 
(SS 
errSS !
)SS! "
;SS" #
throwTT 
;TT 
}UU 
}VV 	
publicXX 
asyncXX 
TaskXX 
<XX 
UsuarioXX !
>XX! "
LoginXX# (
(XX( )
stringXX) /
emailXX0 5
)XX5 6
{YY 	
tryZZ 
{[[ 
return\\ 
await\\ 
dapper\\ #
.\\# $
QueryWithReturn\\$ 3
<\\3 4
Usuario\\4 ;
>\\; <
(\\< =
$str\\= S
,\\S T
new\\U X
{]] 
@Email^^ 
=^^ 
email^^ "
}__ 
)__ 
;__ 
}`` 
catchaa 
(aa 
	Exceptionaa 
erraa  
)aa  !
{bb 
Consolecc 
.cc 
Writecc 
(cc 
errcc !
)cc! "
;cc" #
throwdd 
;dd 
}ee 
}ff 	
}gg 
}hh 